---
description: Не менять старые миграции — создавать новую
alwaysApply: true
---

# Миграции (SQL)

## Правило

**Не вносить изменения в ранее созданные миграции.** Всегда создавать **новую миграцию** с следующим номером.

## Почему

- Уже применённые миграции могли отработать на проде/тесте — изменение ломает воспроизводимость и может вызвать конфликты при деплое.
- История миграций остаётся предсказуемой: один файл = один шаг схемы.

## Как делать

1. Посмотреть последний номер в `sql/` (например `071_*.sql`).
2. Создать новый файл с номером на 1 больше: `072_краткое_описание.sql`.
3. В новой миграции описать только нужное изменение (ALTER, новый RPC, и т.д.).

**Тестовые миграции паков** (INSERT в `pack_content_sets_test`): лежат в **`sql/packs/`**. Нумерация — по последнему файлу в `sql/packs/` (напр. после `133_test_...sql` следующий — `134_test_название_пака_v1.sql`).

## Запрещено

- Редактировать содержимое уже существующих файлов миграций.
- Менять порядок или номера старых миграций.

## Исключения

- Исправление опечатки или явной ошибки в миграции **до** того, как она была применена ни на одном окружении — допустимо, но лучше уточнить у команды.
