---
description: Правила релизов и выката на test/prod (photo2sticker-bot)
alwaysApply: false
---

# Релизы и выкат

## Контекст

- **origin** — удалённый репозиторий (GitHub). `origin/test` = ветка test на сервере.
- Работаем с проектом **photo2sticker-bot** (корень репо: `src/`, `sql/`, `docs/`). Не путать с **aiphoto** (подпапка `aiphoto/`) — при задачах по боту не менять aiphoto.

## Выкат фичи на тест-стенд

**Катим только так.** Тест на Dockhost деплоится с ветки `test`. Никакого force-push в test — только мерж фичи в test и пуш.

**Упрощённо:** находясь на feature-ветке, выполни одну команду:

```bash
npm run deploy:test
```

Скрипт `scripts/deploy-to-test.sh`: при необходимости делает коммит изменений (`chore: deploy to test`), пушит текущую ветку, переключается на test, подтягивает и мержит твою ветку, пушит test, возвращается на feature-ветку.

Вручную (если не используешь скрипт):

```bash
git fetch origin
git checkout test
git pull origin test
git merge origin/feature/my-feature --no-edit
git push
```

После пуша в test Dockhost автоматически пересобирает тестовые контейнеры.

## Выкат в прод (main)

- Прод деплоится с ветки `main` (автодеплой при пуше в main).
- В main пушить только после проверки на тест-боте.

```bash
git checkout main
git pull origin main
git merge feature/my-feature --no-edit
git push origin main
```
