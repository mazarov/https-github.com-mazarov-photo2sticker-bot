---
description: Правила безопасного внесения изменений
alwaysApply: true
---

# Безопасные изменения

## Перед изменениями

1. **НЕ запускать тяжёлые команды** (npm run build, docker build) без явного запроса
2. **Проверять билд локально** только когда пользователь просит деплоить
3. **Не запускать несколько команд параллельно** — система может зависнуть

## Деплой

1. Сначала показать изменения пользователю
2. Дождаться подтверждения
3. Только потом коммитить и пушить

## Shell команды

```bash
# ❌ ПЛОХО — тяжёлая команда без запроса
npm run build

# ✅ ХОРОШО — спросить перед выполнением
"Хочешь проверить билд перед деплоем?"
```

## Правило

Если команда может занять больше 10 секунд или нагрузить систему — **спроси разрешения**.

## Shell

Подробные правила работы с shell — см. `shell-safety.mdc`.

## Багфиксы: проверка архитектурности перед стартом

Перед любым фиксом обязательно сделать **Architecture Check**:

1. Определи, где находится **source of truth** (общий роутер, общий резолвер, общий сервис), а не только место, где проявился баг.
2. Проверь, затрагивает ли дефект несколько flow (`assistant` / `single` / `pack`) или несколько состояний.
3. Формулируй правку так, чтобы она устраняла **класс проблемы**, а не один симптом.

### Запрещено

- Делать фикс только в одном хендлере, если проблема решается в общем слое.
- Закрывать баг "локальным if-ом" без проверки соседних сценариев.

### Разрешено как временная мера (hotfix)

Локальный фикс допустим только если:

1. есть риск инцидента в проде "здесь и сейчас";
2. в задаче явно помечено, что это временный hotfix;
3. сразу создан follow-up на архитектурный фикс.

### Формат отчета по фиксу

В каждом багфиксе явно указывать:

- `Fix type: architectural` или `Fix type: local-hotfix`;
- почему выбран этот тип;
- какие flow/состояния проверены после правки.
