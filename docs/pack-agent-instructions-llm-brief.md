# Бриф для LLM: усиление инструкций агентов пака (1–2 итерации)

## Задача

Есть пайплайн из 5 агентов (LLM) для генерации контента стикерпака: **Concept → Boss → Captions → Scenes → Critic**. Critic проверяет результат и может отклонить (pass=false), тогда Captions и Scenes перезапускаются с контекстом (reasons + suggestions + предыдущий spec). Сейчас часто нужно 2 итерации, а иногда паки всё равно не проходят или проходят «впритык».

**Цель:** усилить system-инструкции агентов так, чтобы они стабильно справлялись с задачей с **1-й или 2-й итерации** — то есть реже получать отказ Critic и чаще исправлять за один цикл переделки.

---

## Контекст продукта

- **Стикерпак** = 9 стикеров. У каждого есть подпись (RU и EN) и визуальное описание сцены. По описаниям потом генерируются картинки (отдельный пайплайн).
- **Подписи** — это то, что человек *напишет в чате*, отправляя стикер: внутренняя реплика, реакция, не описание действия («Я не верю!», «С 23-м!», а не «Записываю на камеру»).
- **Сцены** — только визуал для генерации изображения: поза, выражение, взгляд, фон, действие. Фон должен быть простым (нейтральная стена, однотон, мягкий градиент), без текста и без сложных интерьеров, т.к. фон потом вырезается под стикер.
- **Один день, одна тема** — 9 моментов одного дня, одна среда/костюм при необходимости (офис, отпуск, военная тема и т.д.).

---

## Что уже есть

- Файл **pack-agent-instructions-current.md** содержит текущие system-промпты всех 5 агентов (Concept, Boss, Captions, Scenes, Critic) и правила контекста при переделке.
- Код пайплайна: `src/lib/pack-multiagent.ts`. При отказе Critic в user message для Captions и Scenes добавляются: reasons, suggestions, previousSpec.

---

## Типичные причины отказов Critic (из логов)

- **Подписи:** описательные/нейтральные вместо внутренней реплики; слишком длинные; обрезанные формулировки; эмодзи в подписи; двусмысленные формулировки; слабая «отправляемость» (нет хука для пересылки).
- **Сцены:** сложный/шумный фон (табло, боке, сценический свет); недостаточно взглядов в камеру (нужно 2–3 явных); несоответствие темы (например «Турция/море» без визуальных якорей); боке/blur в описании, что даёт грязные края после вырезки.

---

## Что нужно от тебя (LLM)

1. **Прочитай** текущие инструкции в **pack-agent-instructions-current.md**.
2. **Предложи конкретные изменения** в system-промпты агентов (Concept, Boss, Captions, Scenes, Critic), чтобы:
   - уменьшить число отказов на первом проходе;
   - при переделке по reasons/suggestions агенты стабильно устраняли замечания за одну итерацию.
3. Изменения должны быть **пригодны для вставки в код** (фрагменты текста промптов на английском, как сейчас). Можно добавлять чёткие правила, примеры хороших/плохих формулировок, чек-листы в виде пунктов, запреты и приоритеты.
4. Учитывай:
   - **Captions:** жёсткий лимит 15–20 символов; запрет нарратива и описания действий; обязательность «sendable» реплик и 1–2 хуковых фраз; запрет эмодзи в подписи; избегание двусмысленностей.
   - **Scenes:** только визуал, без текста в описании; строго простой фон (нейтральная стена / однотон / мягкий градиент, без боке и читаемых объектов); явное требование 2–3 сцен с взглядом в камеру; единый день и среда.
   - **Critic:** оставить строгим, но формулировки reasons/suggestions должны быть конкретными и исполнимыми за один проход Captions/Scenes.
5. **Не меняй** формат выходов (JSON, ключи) и общую схему пайплайна — только текст инструкций и правил.

Выдай результат в виде: для каждого агента — текущий фрагмент (или его идентификатор) и предлагаемая новая версия system prompt (полным текстом), плюс краткое обоснование по пунктам выше.
