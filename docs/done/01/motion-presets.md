# –ò–∑–º–µ–Ω–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ ‚Äî –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

## –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫—É "–ò–∑–º–µ–Ω–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ" –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∑—ã/–∂–µ—Å—Ç–∞/–¥–µ–π—Å—Ç–≤–∏—è —Å—Ç–∏–∫–µ—Ä–∞. –õ–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞ "–ò–∑–º–µ–Ω–∏—Ç—å —ç–º–æ—Ü–∏—é".

---

## UI

### –ö–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–∞

```
[–°—Ç–∏–∫–µ—Ä]

[‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫]
[üé® –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å] [üòä –ò–∑–º–µ–Ω–∏—Ç—å —ç–º–æ—Ü–∏—é]
[üèÉ –ò–∑–º–µ–Ω–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ]
```

### –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ –¥–≤–∏–∂–µ–Ω–∏—è

```
üèÉ –í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∏–∂–µ–Ω–∏–µ:

[üëã –ú–∞—à–µ—Ç —Ä—É–∫–æ–π]  [üëç –ö–ª–∞—Å—Å]
[ü§¶ –§–µ–π—Å–ø–∞–ª–º]    [üôè –ú–æ–ª–∏—Ç—Å—è]
[üí™ –°–∏–ª–∞]        [üèÉ –ë–µ–∂–∏—Ç]
[üíÉ –¢–∞–Ω—Ü—É–µ—Ç]     [ü§∑ –ü–æ–∂–∏–º–∞–µ—Ç –ø–ª–µ—á–∞–º–∏]
[‚úåÔ∏è –ú–∏—Ä]        [ü´∂ –°–µ—Ä–¥–µ—á–∫–æ]
[üôà –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞]  [üéâ –ü—Ä–∞–∑–¥–Ω—É–µ—Ç]
[‚úçÔ∏è –°–≤–æ—ë –¥–≤–∏–∂–µ–Ω–∏–µ]
```

---

## –°–ø–∏—Å–æ–∫ –¥–≤–∏–∂–µ–Ω–∏–π (12 + custom)

| id | emoji | name_ru | name_en | prompt_hint | sort_order |
|----|-------|---------|---------|-------------|------------|
| waving | üëã | –ú–∞—à–µ—Ç —Ä—É–∫–æ–π | Waving | waving hand, greeting gesture, friendly wave | 1 |
| thumbs_up | üëç | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å | Thumbs up | thumbs up gesture, approval, like sign | 2 |
| facepalm | ü§¶ | –§–µ–π—Å–ø–∞–ª–º | Facepalm | facepalm gesture, hand on face, frustrated | 3 |
| praying | üôè | –ú–æ–ª–∏—Ç—Å—è | Praying | hands together, praying or pleading gesture | 4 |
| flexing | üí™ | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—É | Flexing | flexing arm, showing bicep, strong pose | 5 |
| running | üèÉ | –ë–µ–∂–∏—Ç | Running | running pose, dynamic movement, legs in motion | 6 |
| dancing | üíÉ | –¢–∞–Ω—Ü—É–µ—Ç | Dancing | dancing pose, joyful movement, party dance | 7 |
| shrugging | ü§∑ | –ü–æ–∂–∏–º–∞–µ—Ç –ø–ª–µ—á–∞–º–∏ | Shrugging | shrugging shoulders, palms up, uncertain | 8 |
| peace | ‚úåÔ∏è | –ó–Ω–∞–∫ –º–∏—Ä–∞ | Peace sign | peace sign gesture, two fingers up, victory | 9 |
| heart_hands | ü´∂ | –°–µ—Ä–¥–µ—á–∫–æ —Ä—É–∫–∞–º–∏ | Heart hands | hands forming heart shape, love gesture | 10 |
| covering_eyes | üôà | –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞ | Covering eyes | hands covering eyes, shy, peek-a-boo | 11 |
| celebrating | üéâ | –ü—Ä–∞–∑–¥–Ω—É–µ—Ç | Celebrating | celebrating pose, arms up, party, cheering | 12 |
| custom | ‚úçÔ∏è | –°–≤–æ—ë –¥–≤–∏–∂–µ–Ω–∏–µ | Custom pose | (user input) | 13 |

---

## –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

1. –ë–µ—Ä—ë–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∏–∫–µ—Ä (`last_sticker_file_id`) –∫–∞–∫ –±–∞–∑—É
2. –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç: `Update the sticker to show this pose/action: {motion_text}. Keep the same character, style, and colors.`
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Gemini
4. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –Ω–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä

---

## –ë–î: —Ç–∞–±–ª–∏—Ü–∞ `motion_presets`

```sql
CREATE TABLE IF NOT EXISTS motion_presets (
  id text PRIMARY KEY,
  emoji text NOT NULL,
  name_ru text NOT NULL,
  name_en text NOT NULL,
  prompt_hint text NOT NULL,
  sort_order int DEFAULT 0,
  is_active boolean DEFAULT true
);

CREATE INDEX IF NOT EXISTS motion_presets_active_idx ON motion_presets (is_active, sort_order);

INSERT INTO motion_presets (id, emoji, name_ru, name_en, prompt_hint, sort_order) VALUES
  ('waving', 'üëã', '–ú–∞—à–µ—Ç —Ä—É–∫–æ–π', 'Waving', 'waving hand, greeting gesture, friendly wave', 1),
  ('thumbs_up', 'üëç', '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å', 'Thumbs up', 'thumbs up gesture, approval, like sign', 2),
  ('facepalm', 'ü§¶', '–§–µ–π—Å–ø–∞–ª–º', 'Facepalm', 'facepalm gesture, hand on face, frustrated', 3),
  ('praying', 'üôè', '–ú–æ–ª–∏—Ç—Å—è', 'Praying', 'hands together, praying or pleading gesture', 4),
  ('flexing', 'üí™', '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—É', 'Flexing', 'flexing arm, showing bicep, strong pose', 5),
  ('running', 'üèÉ', '–ë–µ–∂–∏—Ç', 'Running', 'running pose, dynamic movement, legs in motion', 6),
  ('dancing', 'üíÉ', '–¢–∞–Ω—Ü—É–µ—Ç', 'Dancing', 'dancing pose, joyful movement, party dance', 7),
  ('shrugging', 'ü§∑', '–ü–æ–∂–∏–º–∞–µ—Ç –ø–ª–µ—á–∞–º–∏', 'Shrugging', 'shrugging shoulders, palms up, uncertain', 8),
  ('peace', '‚úåÔ∏è', '–ó–Ω–∞–∫ –º–∏—Ä–∞', 'Peace sign', 'peace sign gesture, two fingers up, victory', 9),
  ('heart_hands', 'ü´∂', '–°–µ—Ä–¥–µ—á–∫–æ —Ä—É–∫–∞–º–∏', 'Heart hands', 'hands forming heart shape, love gesture', 10),
  ('covering_eyes', 'üôà', '–ó–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞', 'Covering eyes', 'hands covering eyes, shy, peek-a-boo', 11),
  ('celebrating', 'üéâ', '–ü—Ä–∞–∑–¥–Ω—É–µ—Ç', 'Celebrating', 'celebrating pose, arms up, party, cheering', 12),
  ('custom', '‚úçÔ∏è', '–°–≤–æ—ë –¥–≤–∏–∂–µ–Ω–∏–µ', 'Custom pose', '', 13)
ON CONFLICT (id) DO UPDATE SET
  name_ru = EXCLUDED.name_ru,
  name_en = EXCLUDED.name_en,
  prompt_hint = EXCLUDED.prompt_hint,
  emoji = EXCLUDED.emoji,
  sort_order = EXCLUDED.sort_order;
```

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ sessions

–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- `wait_motion` ‚Äî –∂–¥—ë–º –≤—ã–±–æ—Ä –¥–≤–∏–∂–µ–Ω–∏—è
- `wait_custom_motion` ‚Äî –∂–¥—ë–º —Ç–µ–∫—Å—Ç —Å–≤–æ–µ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è:
```sql
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS selected_motion text;
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS motion_prompt text;
```

---

## –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

```sql
INSERT INTO bot_texts_new (lang, key, text) VALUES
  ('ru', 'btn.change_motion', 'üèÉ –ò–∑–º–µ–Ω–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ'),
  ('en', 'btn.change_motion', 'üèÉ Change pose'),
  ('ru', 'motion.choose', 'üèÉ –í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∏–∂–µ–Ω–∏–µ:'),
  ('en', 'motion.choose', 'üèÉ Choose a pose:'),
  ('ru', 'motion.custom_prompt', '‚úçÔ∏è –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–∑—É:'),
  ('en', 'motion.custom_prompt', '‚úçÔ∏è Describe the desired pose or action:')
ON CONFLICT (key, lang) DO UPDATE SET text = EXCLUDED.text;
```

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### worker.ts

–î–æ–±–∞–≤–∏—Ç—å `generation_type: "motion"`:

```typescript
const generationType = session.generation_type || 
  (session.state === "processing_emotion" ? "emotion" : 
   session.state === "processing_motion" ? "motion" : "style");
```

### index.ts

1. **–ö–Ω–æ–ø–∫–∞ –≤ replyMarkup** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `change_motion:${stickerId}`

2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `change_motion:ID`** ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `change_emotion:ID`

3. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `motion_*`** ‚Äî –≤—ã–±–æ—Ä –¥–≤–∏–∂–µ–Ω–∏—è –∏–∑ –ø—Ä–µ—Å–µ—Ç–æ–≤

4. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞ –≤ `wait_custom_motion`** ‚Äî —Å–≤–æ—ë –¥–≤–∏–∂–µ–Ω–∏–µ

5. **–§—É–Ω–∫—Ü–∏—è `buildMotionPrompt`**:
```typescript
function buildMotionPrompt(motionText: string) {
  return `Update the sticker to show this pose/action: ${motionText}. Keep the same character, style, and colors.`;
}
```

6. **–§—É–Ω–∫—Ü–∏—è `sendMotionKeyboard`** ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –¥–≤–∏–∂–µ–Ω–∏—è–º–∏

---

## SQL –º–∏–≥—Ä–∞—Ü–∏—è

```sql
-- 016_motion_presets.sql

-- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–µ—Å–µ—Ç–æ–≤ –¥–≤–∏–∂–µ–Ω–∏–π
CREATE TABLE IF NOT EXISTS motion_presets (
  id text PRIMARY KEY,
  emoji text NOT NULL,
  name_ru text NOT NULL,
  name_en text NOT NULL,
  prompt_hint text NOT NULL,
  sort_order int DEFAULT 0,
  is_active boolean DEFAULT true
);

CREATE INDEX IF NOT EXISTS motion_presets_active_idx ON motion_presets (is_active, sort_order);

INSERT INTO motion_presets (id, emoji, name_ru, name_en, prompt_hint, sort_order) VALUES
  ('waving', 'üëã', '–ú–∞—à–µ—Ç —Ä—É–∫–æ–π', 'Waving', 'waving hand, greeting gesture, friendly wave', 1),
  ('thumbs_up', 'üëç', '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å', 'Thumbs up', 'thumbs up gesture, approval, like sign', 2),
  ('facepalm', 'ü§¶', '–§–µ–π—Å–ø–∞–ª–º', 'Facepalm', 'facepalm gesture, hand on face, frustrated', 3),
  ('praying', 'üôè', '–ú–æ–ª–∏—Ç—Å—è', 'Praying', 'hands together, praying or pleading gesture', 4),
  ('flexing', 'üí™', '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—É', 'Flexing', 'flexing arm, showing bicep, strong pose', 5),
  ('running', 'üèÉ', '–ë–µ–∂–∏—Ç', 'Running', 'running pose, dynamic movement, legs in motion', 6),
  ('dancing', 'üíÉ', '–¢–∞–Ω—Ü—É–µ—Ç', 'Dancing', 'dancing pose, joyful movement, party dance', 7),
  ('shrugging', 'ü§∑', '–ü–æ–∂–∏–º–∞–µ—Ç –ø–ª–µ—á–∞–º–∏', 'Shrugging', 'shrugging shoulders, palms up, uncertain', 8),
  ('peace', '‚úåÔ∏è', '–ó–Ω–∞–∫ –º–∏—Ä–∞', 'Peace sign', 'peace sign gesture, two fingers up, victory', 9),
  ('heart_hands', 'ü´∂', '–°–µ—Ä–¥–µ—á–∫–æ —Ä—É–∫–∞–º–∏', 'Heart hands', 'hands forming heart shape, love gesture', 10),
  ('covering_eyes', 'üôà', '–ó–∞–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–∑–∞', 'Covering eyes', 'hands covering eyes, shy, peek-a-boo', 11),
  ('celebrating', 'üéâ', '–ü—Ä–∞–∑–¥–Ω—É–µ—Ç', 'Celebrating', 'celebrating pose, arms up, party, cheering', 12),
  ('custom', '‚úçÔ∏è', '–°–≤–æ—ë –¥–≤–∏–∂–µ–Ω–∏–µ', 'Custom pose', '', 13)
ON CONFLICT (id) DO UPDATE SET
  name_ru = EXCLUDED.name_ru,
  name_en = EXCLUDED.name_en,
  prompt_hint = EXCLUDED.prompt_hint,
  emoji = EXCLUDED.emoji,
  sort_order = EXCLUDED.sort_order;

-- –ü–æ–ª—è –≤ sessions
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS selected_motion text;
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS motion_prompt text;

-- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
INSERT INTO bot_texts_new (lang, key, text) VALUES
  ('ru', 'btn.change_motion', 'üèÉ –ò–∑–º–µ–Ω–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ'),
  ('en', 'btn.change_motion', 'üèÉ Change pose'),
  ('ru', 'motion.choose', 'üèÉ –í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–∏–∂–µ–Ω–∏–µ:'),
  ('en', 'motion.choose', 'üèÉ Choose a pose:'),
  ('ru', 'motion.custom_prompt', '‚úçÔ∏è –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∏–ª–∏ –ø–æ–∑—É:'),
  ('en', 'motion.custom_prompt', '‚úçÔ∏è Describe the desired pose or action:')
ON CONFLICT (key, lang) DO UPDATE SET text = EXCLUDED.text;
```

---

## –ß–µ–∫–ª–∏—Å—Ç

- [ ] SQL –º–∏–≥—Ä–∞—Ü–∏—è `016_motion_presets.sql`
- [ ] index.ts: –∫—ç—à –∏ —Ñ—É–Ω–∫—Ü–∏—è `getMotionPresets()`
- [ ] index.ts: —Ñ—É–Ω–∫—Ü–∏—è `sendMotionKeyboard()`
- [ ] index.ts: —Ñ—É–Ω–∫—Ü–∏—è `buildMotionPrompt()`
- [ ] index.ts: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `change_motion:ID`
- [ ] index.ts: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `motion_*` callbacks
- [ ] index.ts: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞ –≤ `wait_custom_motion`
- [ ] worker.ts: –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É `change_motion` –≤ replyMarkup
- [ ] worker.ts: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `generation_type: "motion"`
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–≤–∏–∂–µ–Ω–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ ru/en
