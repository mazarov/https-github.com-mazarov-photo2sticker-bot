# Guided Onboarding Flow

## –¶–µ–ª—å
–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∏–∫–µ—Ä–∞: –±–∞–∑–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä ‚Üí —ç–º–æ—Ü–∏—è ‚Üí –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ ‚Üí –ø–æ–∫—É–ø–∫–∞.

## –°—Ü–µ–Ω–∞—Ä–∏–π (User Journey)

### –®–∞–≥ 1: –ü–µ—Ä–≤—ã–π —Å—Ç–∏–∫–µ—Ä (–∑–∞ –∫—Ä–µ–¥–∏—Ç)
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: "–ü—Ä–∏–≤–µ—Ç! –û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ ‚Äî —è —Å–¥–µ–ª–∞—é –∏–∑ –Ω–µ–≥–æ —Å—Ç–∏–∫–µ—Ä üé®"
     [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞—á–∏—Å–ª–µ–Ω–æ 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–∞]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ]
–ë–æ—Ç: "–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:"
     [üéå –ê–Ω–∏–º–µ] [üòÇ –ú–µ–º—ã]
     [ü•∞ –ú–∏–ª—ã–π] [üíï –†–æ–º–∞–Ω—Ç–∏–∫–∞]
     [‚úèÔ∏è –°–≤–æ–π —Å—Ç–∏–ª—å]
     (–≥—Ä—É–ø–ø—ã —Å show_in_onboarding=false —Å–∫—Ä—ã—Ç—ã)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≤—ã–±–∏—Ä–∞–µ—Ç "üéå –ê–Ω–∏–º–µ"]
–ë–æ—Ç: "üéå –ê–Ω–∏–º–µ ‚Äî –≤—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:"
     [üéØ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π üì∏] [üåë –¢—ë–º–Ω—ã–π üì∏]
     [‚öîÔ∏è –°—ë–Ω–µ–Ω üì∏] [üíó –†–æ–º–∞–Ω—Ç–∏–∫ üì∏]
     [‚¨ÖÔ∏è –ù–∞–∑–∞–¥]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≤—ã–±–∏—Ä–∞–µ—Ç "üéØ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π"]
–ë–æ—Ç: "üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞–ø—Ä–æ—Å..."
–ë–æ—Ç: "üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ñ–æ—Ç–æ... (1/7)"
     ...
–ë–æ—Ç: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∏–∫–µ—Ä + –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫"]
     "üéâ –í–æ—Ç —Ç–≤–æ–π –ø–µ—Ä–≤—ã–π —Å—Ç–∏–∫–µ—Ä!
      –ê —Ç–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –æ–∂–∏–≤–∏–º –µ–≥–æ ‚Äî –¥–æ–±–∞–≤—å —ç–º–æ—Ü–∏—é:"
     [üòÇ –°–º–µ—Ö] [üòé –ö—Ä—É—Ç–æ–π] [üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π] [üò° –ó–ª–æ–π]
```

### –®–∞–≥ 2: –≠–º–æ—Ü–∏—è (–∑–∞ –∫—Ä–µ–¥–∏—Ç)
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≤—ã–±–∏—Ä–∞–µ—Ç "üòÇ –°–º–µ—Ö"]
–ë–æ—Ç: "‚è≥ –î–æ–±–∞–≤–ª—è—é —ç–º–æ—Ü–∏—é..."
–ë–æ—Ç: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∏–∫–µ—Ä —Å —ç–º–æ—Ü–∏–µ–π + –≤—Å–µ –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏]
     "üî• –û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —Ç—ã —É–º–µ–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∂–∏–≤—ã–µ —Å—Ç–∏–∫–µ—Ä—ã.
      
      –ï—â—ë –º–æ–∂–Ω–æ:
      üèÉ –î–æ–±–∞–≤–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ
      üí¨ –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–∏–∫–µ—Ä–µ
      
      –•–æ—á–µ—à—å —Å–æ–∑–¥–∞—Ç—å –µ—â—ë?"
     [üõí –ö—É–ø–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã] [üì∑ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ]

[–ß–µ—Ä–µ–∑ 30 —Å–µ–∫]
–ë–æ—Ç: "–ö–∞–∫ –≤–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç? –û—Ü–µ–Ω–∏—Ç–µ –æ—Ç 1 –¥–æ 5:"
     [‚≠ê1] [‚≠ê2] [‚≠ê3] [‚≠ê4] [‚≠ê5]
```

### –®–∞–≥ 3: –ü–æ–∫—É–ø–∫–∞ –∏–ª–∏ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ
```
–ï—Å–ª–∏ "–ö—É–ø–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã":
  ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞—Ä–∏—Ñ—ã

–ï—Å–ª–∏ "–ù–æ–≤–æ–µ —Ñ–æ—Ç–æ":
  –ë–æ—Ç: "–û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ ‚Äî —Å–¥–µ–ª–∞–µ–º –Ω–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä!"
  ‚Üí –Ω—É–∂–Ω—ã –∫—Ä–µ–¥–∏—Ç—ã (2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —É–∂–µ –ø–æ—Ç—Ä–∞—á–µ–Ω—ã)
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS onboarding_step int DEFAULT 0;

-- 0 = –Ω–µ –Ω–∞—á–∞—Ç (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
-- 1 = –ø–µ—Ä–≤—ã–π —Å—Ç–∏–∫–µ—Ä —Å–æ–∑–¥–∞–Ω, –∂–¥—ë–º —ç–º–æ—Ü–∏—é
-- 2 = –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –∑–∞–≤–µ—Ä—à—ë–Ω
-- 99 = –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø—Ä–æ–ø—É—â–µ–Ω (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
```

### 2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤

**–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**
- –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ **2 –∫—Ä–µ–¥–∏—Ç–∞** (—Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞—á–∏—Å–ª–∏—Ç)
- –≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ ‚Äî –±–æ–ª—å—à–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –Ω–µ –±—É–¥–µ—Ç

**–°–ø–∏—Å–∞–Ω–∏–µ:**
- –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ `deduct_credits()` –¥–ª—è –í–°–ï–• –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –ù–∏–∫–∞–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ `isOnboardingFree`

### 3. onboarding_step ‚Äî –¢–û–õ–¨–ö–û –¥–ª—è UI

`onboarding_step` —É–ø—Ä–∞–≤–ª—è–µ—Ç **—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º**, –Ω–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ—Å—Ç—å—é:

| onboarding_step | UI –ø–æ–≤–µ–¥–µ–Ω–∏–µ | –°—Ç–∏–ª–∏ |
|-----------------|--------------|-------|
| 0 | –°—Ç–∏–∫–µ—Ä —Å –∫–Ω–æ–ø–∫–æ–π "–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫", –ø–æ–∫–∞–∑–∞—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥-—ç–º–æ—Ü–∏–∏, –±–µ–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞ | –¢–æ–ª—å–∫–æ `show_in_onboarding=true` |
| 1 | –°—Ç–∏–∫–µ—Ä —Å –æ–±—ã—á–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏, —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ä–µ–π—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ 30 —Å–µ–∫ | –¢–æ–ª—å–∫–æ `show_in_onboarding=true` |
| 2, 99 | –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º: –≤—Å–µ –∫–Ω–æ–ø–∫–∏ + —Ä–µ–π—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ 3 —Å–µ–∫ | –í—Å–µ –≥—Ä—É–ø–ø—ã |

### 3.1 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (Styles V2)

–°—Ç–∏–ª–∏ –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (`onboarding_step < 2`):

| –£—Ä–æ–≤–µ–Ω—å | –¢–∞–±–ª–∏—Ü–∞ | –≠—Ñ—Ñ–µ–∫—Ç |
|---------|---------|--------|
| –ì—Ä—É–ø–ø–∞ | `style_groups` | –°–∫—Ä—ã—Ç—å –≤—Å—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é |
| –ü–æ–¥—Å—Ç–∏–ª—å | `style_presets_v2` | –°–∫—Ä—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ç–∏–ª—å –≤ –≥—Ä—É–ø–ø–µ |

```sql
-- –ö–æ–ª–æ–Ω–∫–∞ –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
show_in_onboarding boolean DEFAULT true

-- –°–∫—Ä—ã—Ç—å –≥—Ä—É–ø–ø—ã –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤
UPDATE style_groups SET show_in_onboarding = false WHERE id IN ('russian', 'tv');

-- –°–∫—Ä—ã—Ç—å –ø–æ–¥—Å—Ç–∏–ª—å –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤
UPDATE style_presets_v2 SET show_in_onboarding = false WHERE id = 'anime_dark';
```

**–í –∫–æ–¥–µ:**
```typescript
const isOnboarding = (user.onboarding_step ?? 99) < 2;
await sendStyleGroupsKeyboard(ctx, lang, undefined, isOnboarding);
await sendSubstylesKeyboard(ctx, lang, groupId, messageId, isOnboarding);
// isOnboarding=true ‚Üí —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ show_in_onboarding
```

### 4. –õ–æ–≥–∏–∫–∞ –≤ worker.ts

**–ü—Ä–∏ `onboarding_step === 0` –∏ `generationType === "style"`:**
```typescript
// –°—Ç–∏–∫–µ—Ä —Ç–æ–ª—å–∫–æ —Å –∫–Ω–æ–ø–∫–æ–π "–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫"
const onboardingMarkup = {
  inline_keyboard: [[{ text: addToPackText, callback_data: `add_to_pack:${stickerId}` }]],
};
await sendSticker(telegramId, stickerBuffer, onboardingMarkup);

// –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥

// –ü–æ–∫–∞–∑–∞—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥-—Å–æ–æ–±—â–µ–Ω–∏–µ —Å —ç–º–æ—Ü–∏—è–º–∏ (–±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å")
await sendMessage(telegramId, "üéâ –í–æ—Ç —Ç–≤–æ–π –ø–µ—Ä–≤—ã–π —Å—Ç–∏–∫–µ—Ä!...", {
  inline_keyboard: emotionButtons  // 4 —ç–º–æ—Ü–∏–∏
});

// –û–±–Ω–æ–≤–∏—Ç—å onboarding_step = 1
```

**–ü—Ä–∏ `onboarding_step === 1` –∏ `generationType === "emotion"`:**
```typescript
// –°—Ç–∏–∫–µ—Ä —Å –æ–±—ã—á–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
await sendSticker(telegramId, stickerBuffer, replyMarkup);

// –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
await sendMessage(telegramId, "üî• –û—Ç–ª–∏—á–Ω–æ!...", {
  inline_keyboard: [[buyCredits], [newPhoto]]
});

// –û–±–Ω–æ–≤–∏—Ç—å onboarding_step = 2

// –†–µ–π—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ 30 —Å–µ–∫ (–Ω–µ 3 —Å–µ–∫ –∫–∞–∫ –æ–±—ã—á–Ω–æ)
setTimeout(() => sendRating(), 30000);
```

**–ü—Ä–∏ `onboarding_step >= 2` –∏–ª–∏ `99`:**
```typescript
// –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º: –≤—Å–µ –∫–Ω–æ–ø–∫–∏ + —Ä–µ–π—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ 3 —Å–µ–∫
```

### 5. –î–∏–∞–≥—Ä–∞–º–º–∞

```
[–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è] ‚Üí +2 –∫—Ä–µ–¥–∏—Ç–∞
        ‚Üì
   onboarding_step = 0
        ‚Üì
[–§–æ—Ç–æ]
        ‚Üì
"–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:" (–≥—Ä—É–ø–ø—ã)
   [üéå –ê–Ω–∏–º–µ] [üòÇ –ú–µ–º—ã] [ü•∞ –ú–∏–ª—ã–π] ...
   (show_in_onboarding=false —Å–∫—Ä—ã—Ç—ã)
        ‚Üì
[–í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã, –Ω–∞–ø—Ä. "üéå –ê–Ω–∏–º–µ"]
        ‚Üì
"üéå –ê–Ω–∏–º–µ ‚Äî –≤—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:" (–ø–æ–¥—Å—Ç–∏–ª–∏)
   [üéØ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π] [üåë –¢—ë–º–Ω—ã–π] ...
   [‚¨ÖÔ∏è –ù–∞–∑–∞–¥]
        ‚Üì
[–í—ã–±–æ—Ä –ø–æ–¥—Å—Ç–∏–ª—è] ‚Üê -1 –∫—Ä–µ–¥–∏—Ç
        ‚Üì
   –°—Ç–∏–∫–µ—Ä + "–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫"
   "–î–æ–±–∞–≤—å —ç–º–æ—Ü–∏—é" + 4 –∫–Ω–æ–ø–∫–∏
        ‚Üì
   onboarding_step = 1
        ‚Üì
[–≠–º–æ—Ü–∏—è] ‚Üê -1 –∫—Ä–µ–¥–∏—Ç
   –°—Ç–∏–∫–µ—Ä + –≤—Å–µ –∫–Ω–æ–ø–∫–∏
   –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   [30 —Å–µ–∫] ‚Üí –†–µ–π—Ç–∏–Ω–≥
        ‚Üì
   onboarding_step = 2
        ‚Üì
[–ö—Ä–µ–¥–∏—Ç—ã = 0, –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º]
   –í—Å–µ –≥—Ä—É–ø–ø—ã –≤–∏–¥–Ω—ã (–≤–∫–ª—é—á–∞—è russian, tv)
```

## –ß–µ–∫–ª–∏—Å—Ç

- [x] –ú–∏–≥—Ä–∞—Ü–∏—è: `onboarding_step` –≤ users
- [x] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí `onboarding_step = 99`
- [x] –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ 2 –∫—Ä–µ–¥–∏—Ç–∞
- [x] –£–±—Ä–∞—Ç—å `isOnboardingFree` –∏–∑ startGeneration
- [x] worker.ts: —Å—Ç–∏–∫–µ—Ä —Å "–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫" –ø—Ä–∏ step=0
- [x] worker.ts: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–∏ step=0
- [x] worker.ts: —Ä–µ–π—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ 30 —Å–µ–∫ –ø—Ä–∏ step=1
- [x] worker.ts: –æ–±–Ω–æ–≤–ª—è—Ç—å onboarding_step –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [x] –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—è–∑–∞–Ω –≤—ã–±—Ä–∞—Ç—å —ç–º–æ—Ü–∏—é
- [x] Styles V2: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø –ø–æ `show_in_onboarding`
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
