# Выбор модели по типу генерации

## Цель

Использовать модель высокого качества для стилей (первое впечатление критично), а быструю модель для итераций (emotion/motion).

## Модели

| Тип генерации | Модель | Качество | Стоимость |
|---------------|--------|----------|-----------|
| `style` | `gemini-3-pro-vision` | Высокое | ~$0.01/запрос |
| `emotion` | `gemini-2.5-flash-image` | Хорошее | ~$0.001/запрос |
| `motion` | `gemini-2.5-flash-image` | Хорошее | ~$0.001/запрос |
| `text` | `gemini-3-pro-vision` | Высокое | ~$0.01/запрос |

## Логика

- **Style** — первая генерация из фото, качество критично для конверсии
- **Emotion/Motion** — итерации над существующим стикером, скорость важнее
- **Text** — рендеринг текста требует точности, Pro модель лучше справляется

## Реализация

### worker.ts

```typescript
// Выбор модели по типу генерации
const model = 
  generationType === "style" || generationType === "text"
    ? "gemini-3-pro-vision"    // Nano Banana Pro — качество
    : "gemini-2.5-flash-image"; // Flash — скорость/цена

console.log("Using model:", model, "generationType:", generationType);
```

## Стоимость

### До (всё на Flash)
- Style: $0.001 × 100 = $0.10
- Emotion: $0.001 × 50 = $0.05
- Motion: $0.001 × 30 = $0.03
- **Итого: ~$0.18 на 180 генераций**

### После (Style/Text на Pro)
- Style: $0.01 × 100 = $1.00
- Emotion: $0.001 × 50 = $0.05
- Motion: $0.001 × 30 = $0.03
- **Итого: ~$1.08 на 180 генераций**

**Увеличение:** ~6x для типичного распределения генераций.

## Риски

1. **Стоимость** — мониторить расходы через Google Cloud Console
2. **Скорость** — Pro модель может быть медленнее
3. **Rate limits** — Pro может иметь другие лимиты

## Мониторинг

- Отслеживать расходы в Google Cloud
- Логировать модель в алертах `new_sticker`
- Сравнивать качество и отзывы пользователей

## Чеклист

- [ ] Изменить выбор модели в `worker.ts`
- [ ] Добавить модель в логи/алерты
- [ ] Задеплоить worker
- [ ] Мониторить расходы 24-48 часов
- [ ] Собрать фидбек по качеству
