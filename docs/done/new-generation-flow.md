# New Generation Flow ‚Äî –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

## –û–ø–∏—Å–∞–Ω–∏–µ

–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Ñ–ª–æ—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–æ–≤: –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é **–±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ø–∞–∫**, —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.

---

## –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
2. –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ç–∏–ª—å (–∫–Ω–æ–ø–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç)
3. –°—Ç–∏–∫–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏ **—Å—Ä–∞–∑—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø–∞–∫**
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∏–∫–µ—Ä –∏–∑ –ø–∞–∫–∞

---

## –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–ª–æ—É

```
[–§–æ—Ç–æ] ‚Üí [–í—ã–±–æ—Ä —Å—Ç–∏–ª—è] ‚Üí [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è] ‚Üí [–°—Ç–∏–∫–µ—Ä –≤ —á–∞—Ç + –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π]
                                              ‚Üì
                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                              ‚Üì               ‚Üì               ‚Üì
                     [‚ûï Add to pack]  [üé® Change style]  [üòä Change emotion]
                              ‚Üì               ‚Üì               ‚Üì
                     –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫    –í–µ—Ä–Ω—É—Ç—å—Å—è –∫       –í—ã–±–æ—Ä —ç–º–æ—Ü–∏–∏
                                       –≤—ã–±–æ—Ä—É —Å—Ç–∏–ª—è      (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–æ—É)
```

### –î–µ—Ç–∞–ª–∏

**1. –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–∞:**
- –°—Ç–∏–∫–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç **–∫–∞–∫ sticker** (–Ω–µ document, –Ω–µ photo)
- –°—Ç–∏–∫–µ—Ä **–ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- –ü–æ–¥ —Å—Ç–∏–∫–µ—Ä–æ–º ‚Äî inline-–∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π

**2. –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π:**
```
[‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫]
[üé® –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å]  [üòä –ò–∑–º–µ–Ω–∏—Ç—å —ç–º–æ—Ü–∏—é]
```

**3. –ö–Ω–æ–ø–∫–∞ "‚ûï Add to pack":**
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∏–∫–µ—Ä –≤ **–µ–¥–∏–Ω—ã–π –ø–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- –ï—Å–ª–∏ –ø–∞–∫ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–∫–∞: `stickers_by_<user_id>` (—Å–∏—Å—Ç–µ–º–Ω–æ–µ), title: `My Stickers`
- –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ + —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–∞–∫

**4. –ö–Ω–æ–ø–∫–∞ "üé® Change style":**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ **—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —à–∞–≥—É –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª—è** (`sendStyleKeyboard`)
- –°—Ç–∞—Ä–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ/prompt **—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ –∂–µ —Ñ–æ—Ç–æ
- **–°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è 1 –∫—Ä–µ–¥–∏—Ç** –ø—Ä–∏ –Ω–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**5. –ö–Ω–æ–ø–∫–∞ "üòä Change emotion":**
- **–û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–ª–æ—É** (—Å–º. –Ω–∏–∂–µ)
- –ù–∞ –≤—Ö–æ–¥ Gemini: **—É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å—Ç–∏–∫–µ—Ä** + –≤—ã–±—Ä–∞–Ω–Ω–∞—è —ç–º–æ—Ü–∏—è
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä —Å –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–π —ç–º–æ—Ü–∏–µ–π
- **–°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è 1 –∫—Ä–µ–¥–∏—Ç** –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

---

## Emotion Flow

### –§–ª–æ—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —ç–º–æ—Ü–∏–∏

```
[üòä Change emotion] ‚Üí [–í—ã–±–æ—Ä —ç–º–æ—Ü–∏–∏ –∏–∑ –ø—Ä–µ—Å–µ—Ç–æ–≤] ‚Üí [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è] ‚Üí [–ù–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä + –∫–Ω–æ–ø–∫–∏]
                              ‚Üì
                      [‚úçÔ∏è Custom emotion] ‚Üí [–í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞] ‚Üí [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è]
```

### –ü—Ä–µ—Å–µ—Ç—ã —ç–º–æ—Ü–∏–π (8 —à—Ç—É–∫)

| ID | Emoji | RU | EN | prompt_hint |
|----|-------|----|----|-------------|
| `happy` | üòÑ | –†–∞–¥—É—é—Å—å! | Feeling happy | happy, joyful expression, big smile |
| `warm` | üòä | –¢—ë–ø–ª–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ | Warm mood | warm smile, gentle expression, content |
| `excited` | ü§© | –í –≤–æ—Å—Ç–æ—Ä–≥–µ | Super excited | excited, amazed, star eyes, thrilled |
| `sad` | üò¢ | –ì—Ä—É—Å—Ç–Ω—ã–π | Feeling sad | sad, teary eyes, melancholic |
| `angry` | üò† | –ó–ª–æ–π | Angry | angry, frowning, irritated expression |
| `surprised` | üò≤ | –£–¥–∏–≤–ª—ë–Ω–Ω—ã–π | Surprised | surprised, shocked, wide eyes, open mouth |
| `love` | üòç | –í–ª—é–±–ª—ë–Ω | In love | heart eyes, loving expression, dreamy |
| `custom` | ‚úçÔ∏è | –°–≤–æ—è —ç–º–æ—Ü–∏—è | Custom emotion | *(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Å–∞–º)* |

### Inline-–∫–Ω–æ–ø–∫–∏ —ç–º–æ—Ü–∏–π (2 –≤ —Ä—è–¥)

```
[üòÑ –†–∞–¥—É—é—Å—å!]       [üòä –¢—ë–ø–ª–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ]
[ü§© –í –≤–æ—Å—Ç–æ—Ä–≥–µ]    [üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π]
[üò† –ó–ª–æ–π]          [üò≤ –£–¥–∏–≤–ª—ë–Ω–Ω—ã–π]
[üòç –í–ª—é–±–ª—ë–Ω]       [‚úçÔ∏è –°–≤–æ—è —ç–º–æ—Ü–∏—è]
```

### –õ–æ–≥–∏–∫–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üòä Change emotion"
2. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç inline-–∫–Ω–æ–ø–∫–∏ —Å —ç–º–æ—Ü–∏—è–º–∏
3. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–µ—Å–µ—Ç–∞ ‚Äî –±–µ—Ä—ë—Ç—Å—è `prompt_hint` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
4. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ "Custom" ‚Äî –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. –ù–∞ –≤—Ö–æ–¥ Gemini:
   - **–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å—Ç–∏–∫–µ—Ä** (file_id –∏–ª–∏ –∏–∑ storage)
   - **Emotion prompt**: "Make this character feel {emotion}"
6. –†–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä —Å –Ω–æ–≤–æ–π —ç–º–æ—Ü–∏–µ–π
7. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∏–∫–µ—Ä + —Ç–µ –∂–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π

---

## –°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `wait_photo` | –û–∂–∏–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ |
| `wait_style` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç) |
| `processing` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–∞ |
| `confirm_sticker` | **NEW** ‚Äî –°—Ç–∏–∫–µ—Ä –ø–æ–∫–∞–∑–∞–Ω, –æ–∂–∏–¥–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ |
| `wait_emotion` | **NEW** ‚Äî –í—ã–±–æ—Ä —ç–º–æ—Ü–∏–∏ |
| `wait_custom_emotion` | **NEW** ‚Äî –í–≤–æ–¥ —Å–≤–æ–µ–π —ç–º–æ—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–º |
| `processing_emotion` | **NEW** ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å —ç–º–æ—Ü–∏–µ–π |

---

## –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ `sessions`

```sql
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS last_sticker_file_id text;
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS last_sticker_storage_path text;
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS selected_style_id text;
ALTER TABLE sessions ADD COLUMN IF NOT EXISTS selected_emotion text;
```

---

## –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `emotion_presets`

```sql
CREATE TABLE IF NOT EXISTS emotion_presets (
  id text PRIMARY KEY,
  emoji text NOT NULL,
  name_ru text NOT NULL,
  name_en text NOT NULL,
  prompt_hint text NOT NULL,
  sort_order int DEFAULT 0,
  is_active boolean DEFAULT true
);

INSERT INTO emotion_presets (id, emoji, name_ru, name_en, prompt_hint, sort_order) VALUES
  ('happy', 'üòÑ', '–†–∞–¥—É—é—Å—å!', 'Feeling happy', 'happy, joyful expression, big smile', 1),
  ('warm', 'üòä', '–¢—ë–ø–ª–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ', 'Warm mood', 'warm smile, gentle expression, content', 2),
  ('excited', 'ü§©', '–í –≤–æ—Å—Ç–æ—Ä–≥–µ', 'Super excited', 'excited, amazed, star eyes, thrilled', 3),
  ('sad', 'üò¢', '–ì—Ä—É—Å—Ç–Ω—ã–π', 'Feeling sad', 'sad, teary eyes, melancholic', 4),
  ('angry', 'üò†', '–ó–ª–æ–π', 'Angry', 'angry, frowning, irritated expression', 5),
  ('surprised', 'üò≤', '–£–¥–∏–≤–ª—ë–Ω–Ω—ã–π', 'Surprised', 'surprised, shocked, wide eyes, open mouth', 6),
  ('love', 'üòç', '–í–ª—é–±–ª—ë–Ω', 'In love', 'heart eyes, loving expression, dreamy', 7),
  ('custom', '‚úçÔ∏è', '–°–≤–æ—è —ç–º–æ—Ü–∏—è', 'Custom emotion', '', 8);
```

---

## –ï–¥–∏–Ω—ã–π –ø–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è

1. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º "Add to pack" ‚Äî —Å–æ–∑–¥–∞—ë–º –ø–∞–∫:
   - `name`: `stickers_by_<user_telegram_id>` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
   - `title`: `My Stickers` (–≤–∏–¥–∏–º—ã–π)
2. –°–æ—Ö—Ä–∞–Ω—è–µ–º `sticker_set_name` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
3. –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏—è—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞–∫

### –ù–æ–≤–æ–µ –ø–æ–ª–µ –≤ `users`

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS sticker_set_name text;
```

---

## –°–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤

| –î–µ–π—Å—Ç–≤–∏–µ | –ö—Ä–µ–¥–∏—Ç—ã |
|----------|---------|
| –ü–µ—Ä–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–≤—ã–±–æ—Ä —Å—Ç–∏–ª—è) | 1 |
| Change style ‚Üí –Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | 1 |
| Change emotion ‚Üí –Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | 1 |
| Add to pack | 0 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) |

### –õ–æ–≥–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤

1. –ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º `user.credits >= 1`
2. –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç:
   - –°–æ–æ–±—â–µ–Ω–∏–µ: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
   - Inline-–∫–Ω–æ–ø–∫–∞: "–ö—É–ø–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã"
3. –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ ‚Äî **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º** –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

---

## –ù–æ–≤—ã–µ –∫–ª—é—á–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π

| Key | RU | EN |
|-----|----|----|
| `btn.add_to_pack` | ‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–∫ | ‚ûï Add to pack |
| `btn.change_style` | üé® –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å | üé® Change style |
| `btn.change_emotion` | üòä –ò–∑–º–µ–Ω–∏—Ç—å —ç–º–æ—Ü–∏—é | üòä Change emotion |

### –ö–Ω–æ–ø–∫–∏ —ç–º–æ—Ü–∏–π

| Key | RU | EN |
|-----|----|----|
| `emotion.happy` | üòÑ –†–∞–¥—É—é—Å—å! | üòÑ Feeling happy |
| `emotion.warm` | üòä –¢—ë–ø–ª–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ | üòä Warm mood |
| `emotion.excited` | ü§© –í –≤–æ—Å—Ç–æ—Ä–≥–µ | ü§© Super excited |
| `emotion.sad` | üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π | üò¢ Feeling sad |
| `emotion.angry` | üò† –ó–ª–æ–π | üò† Angry |
| `emotion.surprised` | üò≤ –£–¥–∏–≤–ª—ë–Ω–Ω—ã–π | üò≤ Surprised |
| `emotion.love` | üòç –í–ª—é–±–ª—ë–Ω | üòç In love |
| `emotion.custom` | ‚úçÔ∏è –°–≤–æ—è —ç–º–æ—Ü–∏—è | ‚úçÔ∏è Custom emotion |

### –°–æ–æ–±—â–µ–Ω–∏—è

| Key | RU | EN |
|-----|----|----|
| `sticker.ready` | –°—Ç–∏–∫–µ—Ä –≥–æ—Ç–æ–≤! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: | Sticker is ready! Choose an action: |
| `sticker.added_to_pack` | –°—Ç–∏–∫–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø–∞–∫! üéâ | Sticker added to pack! üéâ |
| `emotion.choose` | –í—ã–±–µ—Ä–∏—Ç–µ —ç–º–æ—Ü–∏—é –¥–ª—è —Å—Ç–∏–∫–µ—Ä–∞: | Choose an emotion for the sticker: |
| `emotion.custom_prompt` | –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º—É—é —ç–º–æ—Ü–∏—é: | Describe the desired emotion: |

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. Worker ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∏–∫–µ—Ä–∞ –±–µ–∑ –ø–∞–∫–∞

```typescript
// –í–º–µ—Å—Ç–æ addStickerToSet + sendSticker –∏–∑ –ø–∞–∫–∞:
// 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç–∏–∫–µ—Ä –∫–∞–∫ document/sticker –Ω–∞–ø—Ä—è–º—É—é
// 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º file_id –≤ sessions.last_sticker_file_id
// 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
```

### 2. Index.ts ‚Äî –Ω–æ–≤—ã–µ callback handlers

```typescript
bot.action("add_to_pack", async (ctx) => { ... });
bot.action("change_style", async (ctx) => { ... });
bot.action("change_emotion", async (ctx) => { ... });
bot.action(/^emotion_(.+)$/, async (ctx) => { ... });
```

### 3. –ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è —ç–º–æ—Ü–∏–π

–°–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç `emotion_transformer` –≤ —Ç–∞–±–ª–∏—Ü–µ `agents`:
- Input: sticker image + emotion description
- Output: transformed sticker with new emotion

---

## –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ enum `session_state`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ `sessions`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `sticker_set_name` –≤ `users`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `emotion_presets`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `bot_texts_new`
- [ ] Worker: –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∏–∫–µ—Ä –±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ø–∞–∫
- [ ] Worker: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `last_sticker_file_id` –≤ —Å–µ—Å—Å–∏—é
- [ ] Index: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∏–∫–µ—Ä–∞
- [ ] Index: handler –¥–ª—è `add_to_pack`
- [ ] Index: handler –¥–ª—è `change_style` (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sendStyleKeyboard`)
- [ ] Index: handler –¥–ª—è `change_emotion`
- [ ] Index: handler –¥–ª—è –≤—ã–±–æ—Ä–∞ —ç–º–æ—Ü–∏–∏
- [ ] Index: handler –¥–ª—è custom emotion (—Ç–µ–∫—Å—Ç)
- [ ] –°–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç `emotion_transformer`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É
