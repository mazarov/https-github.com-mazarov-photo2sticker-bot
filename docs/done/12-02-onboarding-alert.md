# –ê–ª–µ—Ä—Ç "–ü—Ä–æ—à—ë–ª –æ–Ω–±–æ—Ä–¥–∏–Ω–≥" + –∫–Ω–æ–ø–∫–∞ "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—Ä–µ–¥–∏—Ç"

**–î–∞—Ç–∞:** 2026-02-12
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

---

## –°—É—Ç—å

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ (–ø–µ—Ä–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–∞) ‚Äî –≤ –∫–∞–Ω–∞–ª –∞–ª–µ—Ä—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∞–≥–µ–Ω—Ç —Å–æ–±—Ä–∞–ª –≤ —Ö–æ–¥–µ –¥–∏–∞–ª–æ–≥–∞. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫—É "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—Ä–µ–¥–∏—Ç" ‚Äî –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∞–¥–º–∏–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 1 –∫—Ä–µ–¥–∏—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —ç—Ç–æ–º.

---

## 1. –ù–æ–≤—ã–π –∞–ª–µ—Ä—Ç `onboarding_completed`

### –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–æ–≥–¥–∞ `total_generations` –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç —Å 0 –Ω–∞ 1), –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∞–ª–µ—Ä—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ `assistant_sessions`.

**–¢–æ—á–∫–∞ –≤—ã–∑–æ–≤–∞:** `src/worker.ts` ‚Äî –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–∞, –µ—Å–ª–∏ `user.total_generations === 0` (—Ç.–µ. —ç—Ç–æ –±—ã–ª–∞ –ø–µ—Ä–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è).

### –î–∞–Ω–Ω—ã–µ –≤ –∞–ª–µ—Ä—Ç–µ

–ò–∑ `assistant_sessions`:
- `goal` ‚Äî —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—Ç–µ–ª (—Ü–µ–ª—å, –æ–ø–∏—Å–∞–Ω–∏–µ)
- `style` ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å
- `emotion` ‚Äî –≤—ã–±—Ä–∞–Ω–Ω–∞—è —ç–º–æ—Ü–∏—è
- `pose` ‚Äî –≤—ã–±—Ä–∞–Ω–Ω–∞—è –ø–æ–∑–∞
- `sticker_text` ‚Äî —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç–∏–∫–µ—Ä–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- `border` ‚Äî —Å –±–æ—Ä–¥–µ—Ä–æ–º –∏–ª–∏ –Ω–µ—Ç

–ò–∑ `users`:
- `username` / `telegram_id`
- `lang` / `language_code`
- `is_premium` ‚Äî Telegram Premium
- `credits` ‚Äî —Å–∫–æ–ª—å–∫–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- `has_purchased` ‚Äî –±—ã–ª –ª–∏ –ø–ª–∞—Ç—ë–∂
- `utm_source` / `utm_medium` ‚Äî –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª

–ò–∑ `assistant_sessions.goal`:
- `[trial: grant]` / `[trial: deny]` / `[trial: grant_blocked]` ‚Äî —Ä–µ—à–µ–Ω–∏–µ –ø–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º—É –∫—Ä–µ–¥–∏—Ç—É

### –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

```
üéì onboarding_completed

‚è∞ 2026-02-12T12:00:00Z

üë§ @username (123456789)
üåê –Ø–∑—ã–∫: ru | Premium: ‚úÖ
üì¢ –ò—Å—Ç–æ—á–Ω–∏–∫: yandex/cpc

üé® –°—Ç–∏–ª—å: anime
üòä –≠–º–æ—Ü–∏—è: happy
ü§∏ –ü–æ–∑–∞: waving
‚úèÔ∏è –¢–µ–∫—Å—Ç: –ü—Ä–∏–≤–µ—Ç!
üî≤ –ë–æ—Ä–¥–µ—Ä: –¥–∞

üéØ –¶–µ–ª—å: —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∏–∫–µ—Ä –∫–æ—Ç–∞ –≤ –∞–Ω–∏–º–µ —Å—Ç–∏–ª–µ
üéÅ Trial: granted (confidence: high)
üí∞ –ö—Ä–µ–¥–∏—Ç—ã: 0 | –ü–æ–∫—É–ø–∫–∏: –Ω–µ—Ç

[üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—Ä–µ–¥–∏—Ç]
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/lib/alerts.ts`

1. –î–æ–±–∞–≤–∏—Ç—å `"onboarding_completed"` –≤ `AlertType`
2. –î–æ–±–∞–≤–∏—Ç—å —ç–º–æ–¥–∑–∏: `onboarding_completed: "üéì"`

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/worker.ts`

1. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `user.total_generations === 0`
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å `assistant_sessions` –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `sendNotification` —Å –∫–Ω–æ–ø–∫–æ–π

---

## 2. –ö–Ω–æ–ø–∫–∞ "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—Ä–µ–¥–∏—Ç"

### callback_data

```
admin_free_credit:<telegram_id>
```

### –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–≤ `src/index.ts`)

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–∞–∂–∞–≤—à–∏–π ‚Äî –∞–¥–º–∏–Ω (`config.adminIds`)
2. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `telegram_id`
3. –ù–∞—á–∏—Å–ª–∏—Ç—å +1 –∫—Ä–µ–¥–∏—Ç: `UPDATE users SET credits = credits + 1 WHERE id = ...`
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –±–æ—Ç–∞:
   - RU: "üéÅ –¢–µ–±–µ –Ω–∞—á–∏—Å–ª–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—Ä–µ–¥–∏—Ç! –ú–æ–∂–µ—à—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë –æ–¥–∏–Ω —Å—Ç–∏–∫–µ—Ä."
   - EN: "üéÅ You got a free credit! You can generate one more sticker."
5. –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –∫–∞–Ω–∞–ª–µ –∞–ª–µ—Ä—Ç–æ–≤: `ctx.editMessageText("‚úÖ –ö—Ä–µ–¥–∏—Ç –≤—ã–¥–∞–Ω @username")`

### –ü–∞—Ç—Ç–µ—Ä–Ω callback

```typescript
bot.action(/^admin_free_credit:(\d+)$/, async (ctx) => { ... });
```

–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `admin_discount` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞, –ø–æ–∏—Å–∫ —é–∑–µ—Ä–∞, –¥–µ–π—Å—Ç–≤–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏.

---

## 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ —Ñ–∞–π–ª–∞–º

### `src/lib/alerts.ts`
- –î–æ–±–∞–≤–∏—Ç—å `"onboarding_completed"` –≤ `AlertType`
- –î–æ–±–∞–≤–∏—Ç—å `onboarding_completed: "üéì"` –≤ `EMOJI`

### `src/worker.ts`
- –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: –µ—Å–ª–∏ `total_generations === 0`, —Å–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `sendNotification` —Å:
  - `type: "new_sticker"` (–∏–ª–∏ –Ω–æ–≤—ã–π —Ç–∏–ø ‚Äî —Ä–µ—à–∏—Ç—å –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
  - `message`: —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –¥–µ—Ç–∞–ª—è–º–∏
  - `buttons`: `[[{ text: "üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—Ä–µ–¥–∏—Ç", callback_data: "admin_free_credit:<tid>" }]]`

### `src/index.ts`
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `bot.action(/^admin_free_credit:(\d+)$/, ...)`
- –õ–æ–≥–∏–∫–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞ ‚Üí –ø–æ–∏—Å–∫ —é–∑–µ—Ä–∞ ‚Üí `credits + 1` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ —é–∑–µ—Ä—É ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –∞–ª–µ—Ä—Ç–µ

---

## –ß–µ–∫–ª–∏—Å—Ç

- [ ] –î–æ–±–∞–≤–∏—Ç—å `onboarding_completed` –≤ `AlertType` –∏ `EMOJI` –≤ `alerts.ts`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∞–ª–µ—Ä—Ç–∞ –≤ `worker.ts` –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `assistant_sessions` + `users` –¥–ª—è –∞–ª–µ—Ä—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É `admin_free_credit:<tid>` –≤ –∞–ª–µ—Ä—Ç
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `admin_free_credit` –≤ `index.ts`
- [ ] –ù–∞—á–∏—Å–ª—è—Ç—å –∫—Ä–µ–¥–∏—Ç + –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- [ ] –û–±–Ω–æ–≤–ª—è—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∞ "‚úÖ –ö—Ä–µ–¥–∏—Ç –≤—ã–¥–∞–Ω"
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ test
- [ ] –¢–µ—Å—Ç: –ø—Ä–æ–π—Ç–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–ª–µ—Ä—Ç ‚Üí –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ prod
