# Требования: UX флоу пака и pack-примеры стилей

**Дата:** 16.02.2026  
**Связано:** [16-02-pack-content-sets.md](16-02-pack-content-sets.md)

---

## 1. Убрать сообщение «Want to see how your sticker pack will look?»

- Удалить использование `pack.preview_offer` из флоу пака (шаг приглашения и шаг выбора стиля).
- Тексты ключа можно оставить в `texts.ts` / БД для совместимости, но в UI не показывать.

---

## 2. Одно сообщение: карусель поз → выбор стиля

- После нажатия «Попробовать с …» **не** отправлять новое сообщение.
- **Редактировать** то же сообщение (где была карусель наборов) и показывать в нём экран выбора стиля: карусель стилей + кнопка «Посмотреть превью» + кнопка «Назад».
- Сохранять `message_id` и `chat_id` сообщения карусели в сессии (или передавать через callback), чтобы по «Попробовать» вызвать `editMessageText` / `editMessageReplyMarkup` вместо `reply`.

---

## 3. Кнопка «Назад к выбору поз» вместо Cancel

- В меню выбора стиля пака заменить кнопку Cancel на «Назад к выбору поз» (локализация RU/EN).
- По нажатию: вернуть сессию в состояние `wait_pack_carousel`, **отредактировать** то же сообщение обратно в вид карусели наборов (карточка набора с ◀️ ▶️ и «Попробовать с …»).

---

## 4. Превью пака — отдельным сообщением

- Итоговое превью (сгенерированный лист) отправлять **новым** сообщением в чат, а не заменять сообщение с прогрессом.
- Чтобы превью сохранялось в истории чата (пользователь за него заплатил).

---

## 5. Алерты + «Сделать примером» для pack

- При успешной генерации превью пака отправлять в канал алертов сообщение с изображением превью и контекстом (шаблон, стиль, пользователь).
- В сообщении алерта — **inline-кнопка** «Сделать примером».
- По нажатию: сохранять это превью как **pack-пример** для выбранного стиля (`style_presets_v2` или отдельное хранилище).
- **Pack-примеры** не пересекаются с примерами одиночного стикера: при выборе стиля в режиме пака показывать только pack-примеры (если есть), иначе fallback (без примера или общий placeholder).

---

## 6. Хранение и показ pack-примеров

- **Хранение:** колонка `style_presets_v2.pack_example_file_id` (миграция 084). По нажатию «Сделать примером» в алерте сохраняется file_id фото из сообщения.
- **Показ:** в экране выбора стиля в флоу пака (style_preview при state wait_pack_preview_payment) сначала запрашивается `getPackStyleExampleFileId(styleId)`; при наличии — показывается фото (replyWithPhoto), иначе — пример одиночного стикера (replyWithSticker).

---

## Реализовано

- П.1: убран pack.preview_offer; шаг 1 — короткий заголовок (название шаблона) + кнопка.
- П.2: по «Попробовать» карусель редактируется в то же сообщение (editMessageText), в нём показывается выбор стиля; в сессии сохраняются progress_message_id, progress_chat_id.
- П.3: кнопка «Назад к выбору поз» (pack.back_to_poses), callback pack_back_to_carousel; возврат в карусель наборов в том же сообщении.
- П.4: воркер не удаляет сообщение прогресса перед отправкой превью; превью уходит отдельным сообщением.
- П.5: sendPackPreviewAlert(styleId, imageBuffer, details) — фото в алерт-канал + inline «Сделать примером» (pack_make_example:styleId); обработчик сохраняет file_id в style_presets_v2.pack_example_file_id.
- П.6: getPackStyleExampleFileId; в style_preview при wait_pack_preview_payment сначала показывается pack-пример (replyWithPhoto), при отсутствии — пример одиночного стикера.
