# –ö–∞—Ä—É—Å–µ–ª—å —Å—Ç–∏–ª–µ–π

**–°—Ç–∞—Ç—É—Å:** in progress (–Ω–∞ —Ç–µ—Å—Ç–µ)  
**–í–µ—Ç–∫–∞:** `feature/style-carousel`

## –ü—Ä–æ–±–ª–µ–º–∞

–¢–µ–∫—É—â–µ–µ –º–µ–Ω—é —Å—Ç–∏–ª–µ–π ‚Äî –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å—Ç–∏–∫–µ—Ä –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å—Ç–∏–ª–µ, –ø–æ–∫–∞ –Ω–µ –Ω–∞–∂–º—ë—Ç "–ü—Ä–∏–º–µ—Ä". –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª—è.

## –†–µ—à–µ–Ω–∏–µ

–ö–∞—Ä—É—Å–µ–ª—å: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ 2 —Å—Ç–∏–ª—è –∑–∞ —Ä–∞–∑ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Å—Ç–∏–∫–µ—Ä–æ–≤.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ö–∞—Ä—É—Å–µ–ª—å (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∂–∏–º)

1. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ "üé® –°—Ç–∏–ª–∏" –∏–ª–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å –≤–º–µ—Å—Ç–æ –ø–ª–æ—Å–∫–æ–≥–æ —Å–ø–∏—Å–∫–∞
2. –ù–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ ‚Äî **2 —Å—Ç–∏–ª—è**
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∏–ª—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **–∫–∞—Ä—Ç–∏–Ω–∫–∞-–ø—Ä–∏–º–µ—Ä** (—Ñ–æ—Ç–æ –∏–∑ Supabase Storage)
4. –ü–æ–¥ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Å—Ç–∏–ª–µ–π:
   ```
   –í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:

   1Ô∏è‚É£ üéØ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π
   2Ô∏è‚É£ üåë –¢—ë–º–Ω—ã–π
   ```
5. –ö–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º:
   - `[1Ô∏è‚É£ –í—ã–±—Ä–∞—Ç—å]` `[2Ô∏è‚É£ –í—ã–±—Ä–∞—Ç—å]` ‚Äî –≤—ã–±–æ—Ä —Å—Ç–∏–ª—è, –∑–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - `[‚û°Ô∏è –î—Ä—É–≥–∏–µ —Å—Ç–∏–ª–∏]` ‚Äî —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è)
   - `[üìã –í—Å–µ —Å—Ç–∏–ª–∏]` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω—ã–π –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ (–∫–∞–∫ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ)

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

6. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–î—Ä—É–≥–∏–µ —Å—Ç–∏–ª–∏" ‚Äî —É–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ —Ç–µ–∫—Å—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–∞—Ä—É
7. –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ ‚Äî –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–¥—ë—Ç –ø–µ—Ä–≤–∞—è
8. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–í—Å–µ —Å—Ç–∏–ª–∏" ‚Äî —É–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—ã–π –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏

### –ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏–º–µ—Ä–æ–≤

9. –ö–∞—Ä—Ç–∏–Ω–∫–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `stickers` –ø–æ `style_preset_id`:
   - –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Å `is_example = true` –∏ `result_storage_path IS NOT NULL`
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –±–µ—Ä—ë–º –ª—é–±–æ–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∏–∫–µ—Ä —Å `result_storage_path`
10. –ü—É–±–ª–∏—á–Ω—ã–π URL —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è: `{SUPABASE_URL}/storage/v1/object/public/{bucket}/{result_storage_path}`
11. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `replyWithPhoto(url)` ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º –±–æ—Ç–µ (test/prod)
12. –ï—Å–ª–∏ –¥–ª—è —Å—Ç–∏–ª—è –Ω–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ ‚Äî —Å—Ç–∏–ª—å –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–∞—Ä—É—Å–µ–ª–∏ (–±–µ–∑ —Ñ–æ—Ç–æ)

### –í—ã–±–æ—Ä —Å—Ç–∏–ª—è

13. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–í—ã–±—Ä–∞—Ç—å" ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `style_v2:ID`)
14. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `session.state === "wait_style"`, –Ω–∞–ª–∏—á–∏–µ —Ñ–æ—Ç–æ –≤ —Å–µ—Å—Å–∏–∏
15. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `prompt_hint` –∏–∑ `style_presets_v2` –∫–∞–∫ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è `generatePrompt`

### –ì–¥–µ –∑–∞–º–µ–Ω—è–µ–º

–ö–∞—Ä—É—Å–µ–ª—å –∑–∞–º–µ–Ω—è–µ—Ç `sendStyleKeyboardFlat` –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö —Ä—É—á–Ω–æ–≥–æ (manual) —Ä–µ–∂–∏–º–∞:
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ç–æ ‚Üí `wait_style`
- –ö–Ω–æ–ø–∫–∞ "üé® –°—Ç–∏–ª–∏"
- "–ù–∞–∑–∞–¥ –∫ —Å—Ç–∏–ª—è–º" –∏–∑ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–∏–º–µ—Ä–∞
- "–°–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å" (change_style)

–ù–ï –∑–∞–º–µ–Ω—è–µ–º:
- –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º (`sendStyleExamplesKeyboard`)
- Legacy-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`style_group`, `style_groups_back`)
- –ö–Ω–æ–ø–∫–∞ "–í—Å–µ —Å—Ç–∏–ª–∏" –≤ —Å–∞–º–æ–π –∫–∞—Ä—É—Å–µ–ª–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫)

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (index.ts)

- `getStyleExampleUrl(styleId)` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–∑ Supabase Storage
- `sendStyleCarousel(ctx, lang, page)` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞—Ä—É—Å–µ–ª—å

### –ù–æ–≤—ã–µ callback handlers

- `style_carousel_pick:ID` ‚Äî –≤—ã–±–æ—Ä —Å—Ç–∏–ª—è –∏–∑ –∫–∞—Ä—É—Å–µ–ª–∏
- `style_carousel_next:PAGE:MSG_IDS` ‚Äî —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `style_carousel_all:MSG_IDS` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å—Ç–∏–ª–∏ (–ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫)

## –ß—Ç–æ –ø–æ—Ç–æ–º

- [ ] –ü–æ–º–µ—Ç–∏—Ç—å –ª—É—á—à–∏–µ —Å—Ç–∏–∫–µ—Ä—ã `is_example = true` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∏–ª—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ –ø—Ä–æ–¥–µ (—Ç–∞–º file_id –∏ storage_path –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å)
- [ ] –ú–µ—Ä–∂ –≤ main –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
