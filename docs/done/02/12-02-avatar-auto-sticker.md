# –ê–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–∞ –∏–∑ –∞–≤–∞—Ç–∞—Ä–∫–∏ Telegram

**–î–∞—Ç–∞:** 2026-02-12
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2026-02-13
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## –°—É—Ç—å

–î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ø–ª–∞—Ç–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (–Ø–Ω–¥–µ–∫—Å –î–∏—Ä–µ–∫—Ç) ‚Äî –ø—Ä–∏ `/start` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä—ë–º –∞–≤–∞—Ç–∞—Ä–∫—É –∏–∑ Telegram –∏ –≥–µ–Ω–µ—Ä–∏–º –¥–µ–º–æ-—Å—Ç–∏–∫–µ—Ä. –ë–µ—Å–ø–ª–∞—Ç–Ω–æ, –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞ —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º, –±–µ–∑ —Ç—Ä–∞—Ç—ã –∫—Ä–µ–¥–∏—Ç–æ–≤.

–¶–µ–ª—å: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤–∞—É-—ç—Ñ—Ñ–µ–∫—Ç ‚Üí –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è —Å –¥–æ—Ä–æ–≥–æ–≥–æ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.

---

## –°—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π

–°—Ç–∏–ª—å –¥–µ–º–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ **–Ω–µ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω** –≤ –∫–æ–¥–µ. –û–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `app_config`:

| key | value | –æ–ø–∏—Å–∞–Ω–∏–µ |
|-----|-------|----------|
| `avatar_demo_style` | `cartoon_telegram` | ID –ø—Ä–µ—Å–µ—Ç–∞ –∏–∑ `style_presets_v2` |

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–∏ –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥ —á–∏—Ç–∞–µ—Ç `app_config.avatar_demo_style` (—Å –∫–µ—à–µ–º 60 —Å–µ–∫)
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–µ—Å–µ—Ç –∏–∑ `style_presets_v2` –ø–æ —ç—Ç–æ–º—É ID
3. –ë–µ—Ä—ë—Ç `prompt_hint` –ø—Ä–µ—Å–µ—Ç–∞ –∏ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç —á–µ—Ä–µ–∑ `prompt_generator` –∞–≥–µ–Ω—Ç–∞
4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ worker

### –ö–∞–∫ –ø–æ–º–µ–Ω—è—Ç—å —Å—Ç–∏–ª—å

```sql
UPDATE app_config SET value = 'anime_classic', updated_at = now()
WHERE key = 'avatar_demo_style';
```

–ü–æ–¥—Ö–≤–∞—Ç–∏—Ç—Å—è —á–µ—Ä–µ–∑ ‚â§60 —Å–µ–∫ (TTL –∫–µ—à–∞). –†–µ–¥–µ–ø–ª–æ–π –Ω–µ –Ω—É–∂–µ–Ω.

### –§–æ–ª–ª–±—ç–∫

–ï—Å–ª–∏ –∫–ª—é—á `avatar_demo_style` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `app_config` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cartoon_telegram`.
–ï—Å–ª–∏ –ø—Ä–µ—Å–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `style_presets_v2` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `false`, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π flow.

---

## –£—Å–ª–æ–≤–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

–ê–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –í–°–ï —É—Å–ª–æ–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**

1. **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Äî `isNewUser === true` (—Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω –≤ –ë–î)
2. **–ü–ª–∞—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫** ‚Äî `utm_source === "yandex"` –ò `utm_medium === "cpc"` (–∏–∑ start payload)
3. **–ï—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∫–∞** ‚Äî `getUserProfilePhotos` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ö–æ—Ç—è –±—ã 1 —Ñ–æ—Ç–æ

–ï—Å–ª–∏ –ª—é–±–æ–µ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π flow (`startAssistantDialog`).

---

## Flow

### –®–∞–≥ 1: –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –ø—Ä–æ–≥—Ä–µ—Å—Å (~0 —Å–µ–∫)

```
RU: "–ü—Ä–∏–≤–µ—Ç! –Ø –¥–µ–ª–∞—é —Å—Ç–∏–∫–µ—Ä—ã –∏–∑ —Ñ–æ—Ç–æ üé® –°–º–æ—Ç—Ä–∏ ‚Äî —É–∂–µ –≥–æ—Ç–æ–≤–ª—é –æ–¥–∏–Ω –∏–∑ —Ç–≤–æ–µ–π –∞–≤–∞—Ç–∞—Ä–∫–∏, —á—Ç–æ–±—ã —Ç—ã —É–≤–∏–¥–µ–ª –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!"
EN: "Hi! I turn photos into stickers üé® Look ‚Äî I'm already making one from your profile photo so you can see how it works!"
```

### –®–∞–≥ 2: –†–µ–∑—É–ª—å—Ç–∞—Ç (~30 —Å–µ–∫)

–°—Ç–∏–∫–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ post-generation –∫–Ω–æ–ø–∫–∞–º–∏.**

### –®–∞–≥ 3: –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

–ü–æ—Å–ª–µ —Å—Ç–∏–∫–µ—Ä–∞ ‚Äî CTA: "–ü—Ä–∏—à–ª–∏ —Å–≤–æ—ë —Ñ–æ—Ç–æ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –µ—â—ë –ª—É—á—à–µ!"

---

## –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### –ù–µ —Ç—Ä–∞—Ç–∏—Ç –∫—Ä–µ–¥–∏—Ç
`credits_spent: 0` ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–µ–º–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è.

### –ù–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ generation
`total_generations` **–ù–ï –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è**. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è "–Ω–æ–≤—ã–º".

### –ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é ‚Äî –±–µ–∑ `assistant_sessions`.

### –ü—Ä–æ–º–ø—Ç —á–µ—Ä–µ–∑ prompt_generator
–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ (—Ö–∞—Ä–¥–∫–æ–¥ –∞–Ω–∏–º–µ-–ø—Ä–æ–º–ø—Ç), —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–º–ø—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `prompt_generator` –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `prompt_hint` –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω

### handleAvatarAutoGeneration (index.ts)

```typescript
const defaultStyleId = await getAppConfig("avatar_demo_style", "cartoon_telegram");
const preset = await getStylePresetV2ById(defaultStyleId);
if (!preset) {
  console.error("[AvatarAuto] Default preset not found:", defaultStyleId);
  return false;
}
const userInput = preset.prompt_hint;
const promptResult = await generatePrompt(userInput);
const avatarPrompt = promptResult.ok && !promptResult.retry
  ? promptResult.prompt || userInput
  : userInput;

// session:
{
  selected_style_id: defaultStyleId,
  prompt_final: avatarPrompt,
  user_input: `[avatar_demo] ${userInput}`,
  generation_type: "avatar_demo",
  credits_spent: 0,
}
```

### SQL –º–∏–≥—Ä–∞—Ü–∏—è (app_config)

```sql
INSERT INTO app_config (key, value, description) VALUES
  ('avatar_demo_style', 'cartoon_telegram', '–°—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –¥–µ–º–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑ –∞–≤–∞—Ç–∞—Ä–∫–∏')
ON CONFLICT (key) DO NOTHING;
```

---

## Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–∏

| –°–∏—Ç—É–∞—Ü–∏—è | –î–µ–π—Å—Ç–≤–∏–µ |
|----------|----------|
| –ù–µ—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏ | `startAssistantDialog` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π flow) |
| `getUserProfilePhotos` –æ—à–∏–±–∫–∞ | `startAssistantDialog` |
| –ü—Ä–µ—Å–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î | `startAssistantDialog` |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–ø–∞–ª–∞ | –°–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –ø—Ä–∏—à–ª–∏ —Ñ–æ—Ç–æ —Å–∞–º" |
| –ê–≤–∞—Ç–∞—Ä–∫–∞ ‚Äî –Ω–µ –ª–∏—Ü–æ | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å—ë —Ä–∞–≤–Ω–æ |
| –ù–µ –ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ | `startAssistantDialog` |

---

## –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–Ω–≤–µ—Ä—Å–∏—è `/start` ‚Üí –ø–µ—Ä–≤—ã–π "–Ω–∞—Å—Ç–æ—è—â–∏–π" —Å—Ç–∏–∫–µ—Ä (–ø–ª–∞—Ç–Ω—ã–π vs –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫)
- % –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–≤–∞—Ç–∞—Ä–∫–æ–π —Å—Ä–µ–¥–∏ –ø–ª–∞—Ç–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
- Retention –ø–æ—Å–ª–µ –¥–µ–º–æ-—Å—Ç–∏–∫–µ—Ä–∞ vs —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏
