# –°–∫–∏–¥–æ—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ –∞–ª–µ—Ä—Ç–∞—Ö

## –û–ø–∏—Å–∞–Ω–∏–µ

–í –∞–ª–µ—Ä—Ç-–∫–∞–Ω–∞–ª –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è `paywall_shown` –∏ `–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å`. –ö –æ–±–æ–∏–º –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è **–∫–Ω–æ–ø–∫–∏ —Å–∫–∏–¥–æ–∫** (10%, 15%, 25%). –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ —É—Ö–æ–¥–∏—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–∫–∏–¥–æ—á–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏.

## –§–ª–æ—É

**paywall_shown:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –≤–∏–¥–∏—Ç paywall
2. –ê–ª–µ—Ä—Ç-–∫–∞–Ω–∞–ª ‚Üí üö™ paywall_shown (—Ç–µ–∫—Å—Ç –∫–∞–∫ —Å–µ–π—á–∞—Å)
3. –ê–ª–µ—Ä—Ç-–∫–∞–Ω–∞–ª ‚Üí "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É @username?" + [üî• -10%] [üî• -15%] [üî• -25%]
4. –ê–¥–º–∏–Ω –∫–ª–∏–∫–∞–µ—Ç [üî• -15%] ‚Üí –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∫–∏–¥–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∫–Ω–æ–ø–∫–∞ ‚Üí "‚úÖ –°–∫–∏–¥–∫–∞ 15% –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ @username"
```

**–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
2. –ê–ª–µ—Ä—Ç-–∫–∞–Ω–∞–ª ‚Üí üë§ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @username (id) üåê –Ø–∑—ã–∫: ru + [üî• -10%] [üî• -15%] [üî• -25%]
3. –ê–¥–º–∏–Ω –∫–ª–∏–∫–∞–µ—Ç ‚Üí —Ç–æ –∂–µ: —Å–∫–∏–¥–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∫–Ω–æ–ø–∫–∞ ‚Üí "‚úÖ –°–∫–∏–¥–∫–∞ N% –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ @username"
```

---

## –ß–∞—Å—Ç—å 1a: –ö–Ω–æ–ø–∫–∏ —Å–∫–∏–¥–æ–∫ –ø–æ—Å–ª–µ paywall_shown –∞–ª–µ—Ä—Ç–∞

**–ì–¥–µ:** `src/index.ts`, –±–ª–æ–∫ `startGeneration` –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `sendAlert({ type: "paywall_shown" })`

**–ß—Ç–æ:** –ü–æ—Å–ª–µ `sendAlert` –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∞–ª–µ—Ä—Ç-–∫–∞–Ω–∞–ª:

```
–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É @username?
```

–° inline-–∫–Ω–æ–ø–∫–∞–º–∏:
```
[üî• -10%]  [üî• -15%]  [üî• -25%]
```

**callback_data —Ñ–æ—Ä–º–∞—Ç:** `admin_discount:{telegramId}:{percent}`
- `admin_discount:8496896962:10`
- `admin_discount:8496896962:15`
- `admin_discount:8496896962:25`

**–û—Ç–ø—Ä–∞–≤–∫–∞:** —á–µ—Ä–µ–∑ `fetch` –∫ Telegram API `sendMessage` —Å `reply_markup` (—Ç–∞–∫ –∂–µ –∫–∞–∫ `make_example`).

---

## –ß–∞—Å—Ç—å 1b: –ö–Ω–æ–ø–∫–∏ —Å–∫–∏–¥–æ–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ ¬´–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å¬ª

**–ì–¥–µ:** `src/index.ts`, –±–ª–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ insert –≤ `users`), –≤—ã–∑–æ–≤ `sendNotification({ type: "new_user", ... })`

**–ß—Ç–æ:** –î–æ–±–∞–≤–∏—Ç—å `buttons` –≤ –≤—ã–∑–æ–≤ `sendNotification`:

```typescript
sendNotification({
  type: "new_user",
  message: `@${ctx.from?.username || "no\\_username"} (${telegramId})\nüåê –Ø–∑—ã–∫: ${languageCode || "unknown"}${utmInfo}`,
  buttons: [[
    { text: "üî• -10%", callback_data: `admin_discount:${telegramId}:10` },
    { text: "üî• -15%", callback_data: `admin_discount:${telegramId}:15` },
    { text: "üî• -25%", callback_data: `admin_discount:${telegramId}:25` },
  ]],
}).catch(console.error);
```

**callback_data:** —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç `admin_discount:{telegramId}:{percent}` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `admin_discount` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

---

## –ß–∞—Å—Ç—å 2: –ù–æ–≤—ã–µ —Å–∫–∏–¥–æ—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –≤ CREDIT_PACKS

–î–æ–±–∞–≤–∏—Ç—å hidden-–ø–∞–∫–µ—Ç—ã –¥–ª—è 15% –∏ 25%:

| –ü–∞–∫ | –ö—Ä–µ–¥–∏—Ç—ã | –û–±—ã—á–Ω–∞—è —Ü–µ–Ω–∞ | -10% | -15% | -25% |
|---|---|---|---|---|---|
| –°—Ç–∞—Ä—Ç | 10 | 150‚≠ê | 135‚≠ê | 127‚≠ê | 112‚≠ê |
| –ü–æ–ø—É–ª—è—Ä–Ω—ã–π | 30 | 300‚≠ê | 270‚≠ê | 255‚≠ê | 225‚≠ê |
| –ü—Ä–æ | 100 | 700‚≠ê | 630‚≠ê | 595‚≠ê | 525‚≠ê |
| –ú–∞–∫—Å | 250 | 1500‚≠ê | 1350‚≠ê | 1275‚≠ê | 1125‚≠ê |

`callback_data` –¥–ª—è –æ–ø–ª–∞—Ç—ã: `pack_{credits}_{price}` (–Ω–∞–ø—Ä–∏–º–µ—Ä `pack_10_127`, `pack_30_255`)

–î–æ–±–∞–≤–∏—Ç—å –≤ `CREDIT_PACKS`:
```typescript
// -15% discount packs
{ credits: 10, price: 127, price_rub: 84, label_ru: "‚≠ê –°—Ç–∞—Ä—Ç -15%", label_en: "‚≠ê Start -15%", hidden: true },
{ credits: 30, price: 255, price_rub: 211, label_ru: "üíé –ü–æ–ø—É–ª—è—Ä–Ω—ã–π -15%", label_en: "üíé Popular -15%", hidden: true },
{ credits: 100, price: 595, price_rub: 594, label_ru: "üëë –ü—Ä–æ -15%", label_en: "üëë Pro -15%", hidden: true },
{ credits: 250, price: 1275, price_rub: 1267, label_ru: "üöÄ –ú–∞–∫—Å -15%", label_en: "üöÄ Max -15%", hidden: true },
// -25% discount packs
{ credits: 10, price: 112, price_rub: 74, label_ru: "‚≠ê –°—Ç–∞—Ä—Ç -25%", label_en: "‚≠ê Start -25%", hidden: true },
{ credits: 30, price: 225, price_rub: 186, label_ru: "üíé –ü–æ–ø—É–ª—è—Ä–Ω—ã–π -25%", label_en: "üíé Popular -25%", hidden: true },
{ credits: 100, price: 525, price_rub: 524, label_ru: "üëë –ü—Ä–æ -25%", label_en: "üëë Pro -25%", hidden: true },
{ credits: 250, price: 1125, price_rub: 1117, label_ru: "üöÄ –ú–∞–∫—Å -25%", label_en: "üöÄ Max -25%", hidden: true },
```

---

## –ß–∞—Å—Ç—å 3: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback `admin_discount`

**–ì–¥–µ:** `src/index.ts`, –Ω–æ–≤—ã–π `bot.action`

```typescript
bot.action(/^admin_discount:(\d+):(\d+)$/, async (ctx) => {
  // 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–ª–∏–∫–Ω—É–ª –∞–¥–º–∏–Ω (config.adminIds)
  // 2. –ò–∑–≤–ª–µ—á—å telegramId –∏ discountPercent –∏–∑ ctx.match
  // 3. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegramId (getUser)
  // 4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // 5. –°–æ–±—Ä–∞—Ç—å —Å–∫–∏–¥–æ—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ % –∏–∑ CREDIT_PACKS
  // 6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–∫–∏–¥–∫–æ–π + –∫–Ω–æ–ø–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
  // 7. –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –∞–ª–µ—Ä—Ç-–∫–∞–Ω–∞–ª–µ –Ω–∞ "‚úÖ –°–∫–∏–¥–∫–∞ {percent}% –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ @username"
});
```

---

## –ß–∞—Å—Ç—å 4: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–†—É—Å—Å–∫–∏–π:**
```
üî• –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ–±—è!

–°–∫–∏–¥–∫–∞ {percent}% –Ω–∞ –≤—Å–µ –ø–∞–∫–µ—Ç—ã —Å—Ç–∏–∫–µ—Ä–æ–≤ üéâ

üí∞ –í—ã–±–∏—Ä–∞–π:
```
+ inline-–∫–Ω–æ–ø–∫–∏ —Å –ø–∞–∫–µ—Ç–∞–º–∏ (–∫–∞–∫ –≤ `sendBuyCreditsMenu`, –Ω–æ —Ç–æ–ª—å–∫–æ —Å–∫–∏–¥–æ—á–Ω—ã–µ –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ %)

**English:**
```
üî• Special offer just for you!

{percent}% off on all sticker packs üéâ

üí∞ Choose your pack:
```
+ inline keyboard —Å –ø–∞–∫–µ—Ç–∞–º–∏

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –Ω—é–∞–Ω—Å—ã

- **–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã** –º–æ–≥—É—Ç –Ω–∞–∂–∏–º–∞—Ç—å –∫–Ω–æ–ø–∫–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ `config.adminIds`)
- **–ö–Ω–æ–ø–∫–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è** ‚Äî –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ" —á–µ—Ä–µ–∑ `ctx.editMessageText`
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–µ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ** –µ—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ ‚Äî –æ–±–µ—Ä–Ω—É—Ç—å –≤ try/catch
- **–°–∫–∏–¥–æ—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã hidden** ‚Äî –Ω–µ –≤–∏–¥–Ω—ã –≤ –æ–±—ã—á–Ω–æ–º –º–µ–Ω—é, –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ –ø—Ä—è–º–æ–º—É callback

---

## –ß–µ–∫–ª–∏—Å—Ç

- [ ] –î–æ–±–∞–≤–∏—Ç—å hidden-–ø–∞–∫–µ—Ç—ã -15% –∏ -25% –≤ `CREDIT_PACKS`
- [ ] –ü–æ—Å–ª–µ `sendAlert({ type: "paywall_shown" })` ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Å–∫–∏–¥–æ–∫
- [ ] –í `sendNotification({ type: "new_user" })` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `buttons` —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ [üî• -10%] [üî• -15%] [üî• -25%]
- [ ] `bot.action(/^admin_discount/)` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –∞–¥–º–∏–Ω–∞ (–æ–±—â–∏–π –¥–ª—è paywall –∏ new_user)
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∫–∏–¥–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ –∫–∞–Ω–∞–ª–µ –Ω–∞ "‚úÖ –°–∫–∏–¥–∫–∞ N% –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ @username"
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–±–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω)
