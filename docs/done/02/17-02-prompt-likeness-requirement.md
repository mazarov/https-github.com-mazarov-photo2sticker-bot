# Требование: сохранение узнаваемости в стикерах (веснушки, родинки, цвет глаз)

**Дата:** 17.02.2026  
**Статус:** реализовано в коде (LIKENESS_SUFFIX, buildAssistantPrompt)

---

## 1. Суть требования

Стикеры должны быть **узнаваемы** как конкретный человек. Пользователи жалуются, что результат «даже отдалённо не похож на референс» или «не похожи на меня» — в том числе из‑за того, что модель не сохраняет:

- **Веснушки**
- **Родинки и родимые пятна** (в т.ч. над губой, на лице)
- **Цвет глаз** (точное совпадение с фото)
- Другие **узнаваемые детали** (форма лица, тон кожи и т.п.)

Требование: усилить промпт так, чтобы модель **подмечала и сохраняла** эти особенности при генерации стикера.

---

## 2. Источник (фидбек)

- Пользователь 1: «стикеры даже отдалённо не похожи на референс» (речь про сходство с человеком на фото).
- Пользователь 2: «стикеры не совсем похожи на меня. У меня есть веснушки и родинка над губой, на фото не видно, но все кто знают меня в жизни скажут что не похоже. Дополнить нельзя. Цвет глаз другой.»

---

## 3. Реализация в коде

### 3.1. Блок LIKENESS_SUFFIX (`src/index.ts`)

Добавлен константный суффикс, который подмешивается ко всем генерациям (одиночный стикер и пак), после subject lock и до COMPOSITION_SUFFIX:

- Сохранять и явно показывать **узнаваемые детали лица**: веснушки, родинки, родимые пятна. Если они видны на референсе — они должны быть в результате.
- **Цвет глаз** должен совпадать с референсом (тон и насыщенность).
- Сохранять форму лица, тон кожи и прочие детали, по которым человека узнают те, кто знает его в жизни.

### 3.2. Ассистент (buildAssistantPrompt)

В блок Subject добавлена явная строка: сохранять отличительные детали (веснушки, родинки, родимые пятна); цвет глаз должен точно совпадать с референсом.

### 3.3. Где подмешивается

- `startGeneration`: `options.promptFinal += LIKENESS_SUFFIX + COMPOSITION_SUFFIX`
- Pack flow (`pack_preview_pay`): `packPromptFinal += LIKENESS_SUFFIX + COMPOSITION_SUFFIX`
- Промпт ассистента: текст в buildAssistantPrompt (Subject).

---

## 4. Ограничение

Если веснушки/родинка **не видны на загруженном фото** («на фото не видно»), модель их не «придумает». Текущее требование улучшает результат, когда эти детали **есть на референсе**. Для кейса «на фото не видно» возможна отдельная доработка: поле «дополнить» (например, текстовое описание: «у меня веснушки и родинка над губой») и подмешивание этого в промпт.

---

## 5. Чеклист

- [x] LIKENESS_SUFFIX добавлен и подключён к single и pack
- [x] buildAssistantPrompt обновлён
- [ ] (опционально) Поле «дополнить» для текстового описания особенностей, не видных на фото
