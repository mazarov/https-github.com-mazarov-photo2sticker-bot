# Paywall –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π

## 1. –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç—Ä–∞—Ç—è—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã, –Ω–æ –Ω–µ –ø–æ–∫—É–ø–∞—é—Ç. –ù—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –ø–ª–∞—Ç—è—â–∏—Ö –î–û —Ç—Ä–∞—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é.

---

## 2. –ù–æ–≤—ã–π —Ñ–ª–æ—É

```
/start ‚Üí "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –°–æ–∑–¥–∞–π —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Å—Ç–∏–∫–µ—Ä üé®"
   ‚Üì
–§–æ—Ç–æ ‚Üí –í—ã–±–æ—Ä —Å—Ç–∏–ª—è
   ‚Üì
–ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º: credits == 0 && has_purchased == false?
   ‚Üì
–î–ê ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ–º paywall:
   "–°—Ç–∏–∫–µ—Ä –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤! üî•
    
    –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –≥–µ–Ω–µ—Ä–∞—Ü–∏—é, –∫—É–ø–∏–≤ –ø–∞–∫–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤.
    
    üéÅ –ë–æ–Ω—É—Å: +2 –∫—Ä–µ–¥–∏—Ç–∞ –∫ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–µ!"
    
   [‚≠ê 10 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 99‚ÇΩ]
   [üíé 30 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 249‚ÇΩ]
   [üëë 100 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 699‚ÇΩ]
   [üöÄ 250 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 1490‚ÇΩ]
   ‚Üì
–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏:
   1. –ù–∞—á–∏—Å–ª—è–µ–º –∫—É–ø–ª–µ–Ω–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã
   2. –ù–∞—á–∏—Å–ª—è–µ–º +2 –±–æ–Ω—É—Å–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–∞ (–ø–µ—Ä–≤–∞—è –ø–æ–∫—É–ø–∫–∞)
   3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
   4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º has_purchased = true
```

---

## 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î

```sql
ALTER TABLE users ADD COLUMN IF NOT EXISTS has_purchased boolean DEFAULT false;
COMMENT ON COLUMN users.has_purchased IS 'True –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è paywall –∏ –±–æ–Ω—É—Å–∞ +2.';
```

---

## 4. –ü–∞–∫–µ—Ç—ã –∫—Ä–µ–¥–∏—Ç–æ–≤

| –ü–∞–∫–µ—Ç | –ö—Ä–µ–¥–∏—Ç—ã | RU (‚ÇΩ) | EN ($) | –¶–µ–Ω–∞/–∫—Ä–µ–¥–∏—Ç |
|-------|---------|--------|--------|-------------|
| ‚≠ê –°—Ç–∞—Ä—Ç | 10 | 99‚ÇΩ | $1.49 | 9.9‚ÇΩ |
| üíé –ü–æ–ø—É–ª—è—Ä–Ω—ã–π | 30 | 249‚ÇΩ | $3.49 | 8.3‚ÇΩ |
| üëë –ü—Ä–æ | 100 | 699‚ÇΩ | $9.99 | 7‚ÇΩ (NEW) |
| üöÄ –ú–∞–∫—Å | 250 | 1490‚ÇΩ | $19.99 | 5.96‚ÇΩ (NEW) |

---

## 5. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 5.1 `/start` handler
- –£–±—Ä–∞—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ 2 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤
- –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (—É–±—Ä–∞—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤)

### 5.2 `startGeneration()` 
- –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º job –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
  ```typescript
  if (user.credits < creditsNeeded && !user.has_purchased) {
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ —Å–µ—Å—Å–∏—é
    // –ü–æ–∫–∞–∑–∞—Ç—å paywall
    return;
  }
  ```

### 5.3 –ù–æ–≤—ã–π state: `wait_first_purchase`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—Å—Ç–∏–ª—å, —Ñ–æ—Ç–æ, –ø—Ä–æ–º–ø—Ç)
- –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é

### 5.4 Payment success handler
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `!user.has_purchased`
- –ï—Å–ª–∏ true ‚Üí –Ω–∞—á–∏—Å–ª–∏—Ç—å +2 –±–æ–Ω—É—Å–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `has_purchased = true`
- –ï—Å–ª–∏ –µ—Å—Ç—å `pending_generation` ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ—ë

### 5.5 –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã
- `config.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å price IDs –¥–ª—è 100 –∏ 250 –∫—Ä–µ–¥–∏—Ç–æ–≤
- `texts.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫
- Payment buttons ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞ 4 –∫–Ω–æ–ø–∫–∏

---

## 6. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

### RU
```yaml
paywall.title: "–°—Ç–∏–∫–µ—Ä –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤! üî•"
paywall.description: "–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –≥–µ–Ω–µ—Ä–∞—Ü–∏—é, –∫—É–ø–∏–≤ –ø–∞–∫–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤."
paywall.bonus: "üéÅ –ë–æ–Ω—É—Å: +2 –∫—Ä–µ–¥–∏—Ç–∞ –∫ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–µ!"
paywall.bonus_applied: "üéÅ –ë–æ–Ω—É—Å +2 –∫—Ä–µ–¥–∏—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω!"
paywall.generation_started: "‚ú® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞!"

credits.pack_10: "‚≠ê 10 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 99‚ÇΩ"
credits.pack_30: "üíé 30 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 249‚ÇΩ"
credits.pack_100: "üëë 100 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 699‚ÇΩ"
credits.pack_250: "üöÄ 250 –∫—Ä–µ–¥–∏—Ç–æ–≤ ‚Äî 1490‚ÇΩ"

welcome.title: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Photo2Sticker! üé®"
welcome.description: "–ü—Ä–µ–≤—Ä–∞—â–∞—é —Ç–≤–æ–∏ —Ñ–æ—Ç–æ –≤ –∫—Ä—É—Ç—ã–µ —Å—Ç–∏–∫–µ—Ä—ã.\n\n–û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!"
welcome.first_purchase_bonus: "üí° –ë–æ–Ω—É—Å +2 –∫—Ä–µ–¥–∏—Ç–∞ –∫ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–µ!"
```

### EN
```yaml
paywall.title: "Sticker almost ready! üî•"
paywall.description: "Unlock generation by purchasing a credit package."
paywall.bonus: "üéÅ Bonus: +2 credits with your first purchase!"
paywall.bonus_applied: "üéÅ Bonus +2 credits applied!"
paywall.generation_started: "‚ú® Generation started!"

credits.pack_10: "‚≠ê 10 credits ‚Äî $1.49"
credits.pack_30: "üíé 30 credits ‚Äî $3.49"
credits.pack_100: "üëë 100 credits ‚Äî $9.99"
credits.pack_250: "üöÄ 250 credits ‚Äî $19.99"

welcome.title: "Welcome to Photo2Sticker! üé®"
welcome.description: "I turn your photos into cool stickers.\n\nSend a photo to start!"
welcome.first_purchase_bonus: "üí° Bonus +2 credits with your first purchase!"
```

---

## 7. –ß–µ–∫–ª–∏—Å—Ç

- [x] SQL –º–∏–≥—Ä–∞—Ü–∏—è: `has_purchased` (`sql/039_has_purchased.sql`)
- [ ] –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã –≤ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (100, 250 –∫—Ä–µ–¥–∏—Ç–æ–≤) ‚Äî **—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã –≤ `CREDIT_PACKS` (index.ts)
- [x] –£–±—Ä–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã –∏–∑ `/start`
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É paywall –≤ `startGeneration()`
- [x] –î–æ–±–∞–≤–∏—Ç—å state `wait_first_purchase`
- [x] –û–±–Ω–æ–≤–∏—Ç—å payment success: –±–æ–Ω—É—Å +2 –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [x] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç—ã –≤ `texts.ts`
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–ª–æ—É
