# –ë–∏–∑–Ω–µ—Å-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Business Notifications)

## –¶–µ–ª—å

–ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –≤ Telegram-–∫–∞–Ω–∞–ª –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞.

## –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

| –¢–∏–ø | Emoji | –ö–æ–≥–¥–∞ |
|-----|-------|-------|
| `new_user` | üë§ | –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è |
| `new_sticker` | üé® | –°—Ç–∏–∫–µ—Ä —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω |
| `new_payment` | üí∞ | –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ |

## –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

### –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```
üë§ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

@username (42269230)
üåê –Ø–∑—ã–∫: ru
```

### –ù–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä (—Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π)
```
üé® –ù–æ–≤—ã–π —Å—Ç–∏–∫–µ—Ä

üë§ @username (42269230)
üé≠ –¢–∏–ø: style (anime)

[–°—Ç–∏–∫–µ—Ä –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ]
```

### –ù–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞
```
üí∞ –ù–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞

üë§ @username (42269230)
üì¶ –ü–∞–∫–µ—Ç: 30 –∫—Ä–µ–¥–∏—Ç–æ–≤
‚≠ê –°—É–º–º–∞: 150 Stars
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –∫–∞–Ω–∞–ª —á—Ç–æ –∏ –¥–ª—è –æ—à–∏–±–æ–∫:
```env
ALERT_CHANNEL_ID=-100xxx
```

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø: –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–ª–æ—É

–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **–±–µ–∑ await** ‚Äî –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:

```typescript
sendNotification(...).catch(err => console.error("Notification failed:", err));
```

### –ú–æ–¥—É–ª—å: `src/lib/alerts.ts`

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∏ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ:

```typescript
type NotificationType = "new_user" | "new_sticker" | "new_payment";

async function sendNotification(options: {
  type: NotificationType;
  message: string;
  imageBuffer?: Buffer;  // –î–ª—è —Å—Ç–∏–∫–µ—Ä–∞
}): Promise<void>;
```

### –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

| –§–∞–π–ª | –ú–µ—Å—Ç–æ | –¢–∏–ø |
|------|-------|-----|
| `index.ts` | –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ /start | `new_user` |
| `worker.ts` | –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç–∏–∫–µ—Ä–∞ | `new_sticker` |
| `index.ts` | –ü–æ—Å–ª–µ successful_payment | `new_payment` |

### index.ts ‚Äî new_user

```typescript
// –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if (isNewUser && user) {
  sendNotification({
    type: "new_user",
    message: `@${ctx.from?.username || "no_username"} (${telegramId})\nüåê –Ø–∑—ã–∫: ${lang}`,
  }).catch(console.error);
}
```

### worker.ts ‚Äî new_sticker

```typescript
// –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∏–∫–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
sendNotification({
  type: "new_sticker",
  message: `üë§ @${user.username || user.telegram_id}\nüé≠ –¢–∏–ø: ${generationType}`,
  imageBuffer: stickerBuffer,
}).catch(console.error);
```

### index.ts ‚Äî new_payment

```typescript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
sendNotification({
  type: "new_payment",
  message: `üë§ @${user.username || telegramId}\nüì¶ –ü–∞–∫–µ—Ç: ${amount} –∫—Ä–µ–¥–∏—Ç–æ–≤\n‚≠ê –°—É–º–º–∞: ${price} Stars`,
}).catch(console.error);
```

## Checklist

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/lib/alerts.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `sendNotification` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `index.ts` ‚Äî new_user –ø—Ä–∏ /start
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `worker.ts` ‚Äî new_sticker –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `index.ts` ‚Äî new_payment –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä—ë—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
