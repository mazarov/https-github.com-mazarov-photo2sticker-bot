# –ö–∞—Ä—É—Å–µ–ª—å —Å—Ç–∏–ª–µ–π ‚Äî `sendStyleCarousel()`

## –û–±–∑–æ—Ä

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª–µ–π —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏.
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ 2 —Å—Ç–∏–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ.

## –í–Ω–µ—à–Ω–∏–π –≤–∏–¥

```
[–°—Ç–∏–∫–µ—Ä-–ø—Ä–∏–º–µ—Ä —Å—Ç–∏–ª—è 1]
[–°—Ç–∏–∫–µ—Ä-–ø—Ä–∏–º–µ—Ä —Å—Ç–∏–ª—è 2]

üìå –í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å:
1. üéå –ê–Ω–∏–º–µ –∫–ª–∞—Å—Å–∏–∫–∞
2. üåë –¢—ë–º–Ω–æ–µ –∞–Ω–∏–º–µ

[–í—ã–±—Ä–∞—Ç—å 1] [–í—ã–±—Ä–∞—Ç—å 2]
[‚¨ÖÔ∏è] [1/5] [‚û°Ô∏è]
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```mermaid
flowchart TD
    ENTER[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª üé® –°—Ç–∏–ª–∏<br/>–∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ] --> FETCH[–ó–∞–≥—Ä—É–∑–∏—Ç—å style_presets_v2<br/>is_active=true, sort_order]
    FETCH --> PAGE[–†–∞–∑–±–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã<br/>PAGE_SIZE = 2]
    PAGE --> EXAMPLES[–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∏–ª—è<br/>–Ω–∞–π—Ç–∏ –ø—Ä–∏–º–µ—Ä —Å—Ç–∏–∫–µ—Ä–∞]
    EXAMPLES --> SEND_STICKERS[–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∏–∫–µ—Ä—ã-–ø—Ä–∏–º–µ—Ä—ã]
    SEND_STICKERS --> SEND_TEXT[–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç + –∫–Ω–æ–ø–∫–∏]

    SEND_TEXT --> USER_ACTION{–î–µ–π—Å—Ç–≤–∏–µ?}
    USER_ACTION -->|–í—ã–±—Ä–∞—Ç—å| PICK[style_carousel_pick:ID<br/>‚Üí startGeneration]
    USER_ACTION -->|‚¨ÖÔ∏è / ‚û°Ô∏è| NEXT[style_carousel_next:PAGE<br/>‚Üí —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è<br/>‚Üí sendStyleCarousel –Ω–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞]
```

## –ü–æ–∏—Å–∫ –ø—Ä–∏–º–µ—Ä–æ–≤ —Å—Ç–∏–∫–µ—Ä–æ–≤

–§—É–Ω–∫—Ü–∏—è `getStyleStickerFileId(styleId)`:

1. –ò—â–µ—Ç —Å—Ç–∏–∫–µ—Ä —Å `is_example = true` –∏ `env` = —Ç–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –±–µ—Ä—ë—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∏–∫–µ—Ä –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ç–∏–ª—è –≤ —Ç–µ–∫—É—â–µ–º `env`
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `telegram_file_id` (–±–æ—Ç-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π)

**–í–∞–∂–Ω–æ**: `telegram_file_id` –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –±–æ—Ç—É.
–°—Ç–∏–∫–µ—Ä, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ test-–±–æ—Ç–∞, –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ prod-–±–æ—Ç–µ.
–ü–æ—ç—Ç–æ–º—É —Ñ–∏–ª—å—Ç—Ä –ø–æ `env` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.

## –ù–∞–≤–∏–≥–∞—Ü–∏—è

| –ö–Ω–æ–ø–∫–∞ | Callback | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|
| –í—ã–±—Ä–∞—Ç—å 1 | `style_carousel_pick:STYLE_ID` | –í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π —Å—Ç–∏–ª—å |
| –í—ã–±—Ä–∞—Ç—å 2 | `style_carousel_pick:STYLE_ID` | –í—ã–±—Ä–∞—Ç—å –≤—Ç–æ—Ä–æ–π —Å—Ç–∏–ª—å |
| ‚¨ÖÔ∏è | `style_carousel_next:PREV_PAGE:MSG_IDS` | –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| 1/5 | `noop` | –°—á—ë—Ç—á–∏–∫ —Å—Ç—Ä–∞–Ω–∏—Ü (–Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è) |
| ‚û°Ô∏è | `style_carousel_next:NEXT_PAGE:MSG_IDS` | –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |

–ù–∞–≤–∏–≥–∞—Ü–∏—è **—Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è**: –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí –ø–µ—Ä–≤–∞—è, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.

## –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ‚¨ÖÔ∏è / ‚û°Ô∏è:
1. –£–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å—Ç–∏–∫–µ—Ä—ã + —Ç–µ–∫—Å—Ç) –ø–æ `MSG_IDS`
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `sendStyleCarousel(ctx, lang, nextPage)`
3. –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ `MSG_IDS`

`MSG_IDS` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ callback_data –≤ —Ñ–æ—Ä–º–∞—Ç–µ `style_carousel_next:PAGE:ID1,ID2,ID3`.

## –í—ã–±–æ—Ä —Å—Ç–∏–ª—è

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–í—ã–±—Ä–∞—Ç—å":
1. –ü–æ–ª—É—á–∞–µ–º `session` –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º `state === wait_style`
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–æ—Ç–æ (`getUserPhotoFileId`)
3. –ï—Å–ª–∏ —Ñ–æ—Ç–æ –∏–∑ `user.last_photo_file_id` ‚Äî –∫–æ–ø–∏—Ä—É–µ–º –≤ —Å–µ—Å—Å–∏—é
4. –ü–æ–ª—É—á–∞–µ–º `prompt_hint` –ø—Ä–µ—Å–µ—Ç–∞
5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç —á–µ—Ä–µ–∑ `generatePrompt()`
6. –ó–∞–ø—É—Å–∫–∞–µ–º `startGeneration()`
