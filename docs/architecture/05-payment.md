# –û–ø–ª–∞—Ç–∞ ‚Äî Telegram Stars

## –≠–∫–æ–Ω–æ–º–∏–∫–∞

### –ö—É—Ä—Å—ã –∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| 100 Telegram Stars | $1.30 |
| 1 Star | $0.013 ‚âà 1.04 ‚ÇΩ |
| –ö—É—Ä—Å ‚ÇΩ/$ | 80 ‚ÇΩ –∑–∞ $1 |
| 1 –ø–∞–∫ —Å—Ç–∏–∫–µ—Ä–æ–≤ | 10 –∫—Ä–µ–¥–∏—Ç–æ–≤ (10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π) |
| –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å 1 –ø–∞–∫–∞ | **15 ‚ÇΩ** |
| –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å 1 –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | ~1.5 ‚ÇΩ |

### –§–æ—Ä–º—É–ª–∞ –º–∞—Ä–∂–∏

```
–ú–∞—Ä–∂–∞ % = (–í—ã—Ä—É—á–∫–∞ ‚ÇΩ ‚àí –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å ‚ÇΩ) / –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å ‚ÇΩ √ó 100

–í—ã—Ä—É—á–∫–∞ ‚ÇΩ = Stars √ó 1.04
–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å ‚ÇΩ = (–ö—Ä–µ–¥–∏—Ç—ã / 10) √ó 15‚ÇΩ
```

–î–ª—è trial-–ø–∞–∫–µ—Ç–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç **–∏—Ç–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤** (–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö + –±–æ–Ω—É—Å–Ω—ã—Ö),
–ø–æ—Ç–æ–º—É —á—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞—Å—Ö–æ–¥—É—é—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –æ–ø–ª–∞—á–µ–Ω—ã –æ–Ω–∏ –∏–ª–∏ –Ω–µ—Ç.

---

## –ü–∞–∫–µ—Ç—ã –∫—Ä–µ–¥–∏—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –ö—Ä–µ–¥–∏—Ç—ã | –ë–æ–Ω—É—Å | –ò—Ç–æ–≥–æ | –¶–µ–Ω–∞ Stars | ~‚ÇΩ | Stars/–≥–µ–Ω | –ú–∞—Ä–∂–∞ % | –£—Å–ª–æ–≤–∏–µ |
|---|---|---|---|---|---|---|---|---|---|
| test | üîß –¢–µ—Å—Ç | 1 | ‚Äî | 1 | 1‚≠ê | 1‚ÇΩ | 1.0 | ‚Äî | adminOnly |
| try | üéÅ –ü–æ–ø—Ä–æ–±—É–π | 5 | +5 | **10** | 49‚≠ê | 51‚ÇΩ | 4.9 | 247% | trialOnly (1—è –ø–æ–∫—É–ø–∫–∞) |
| start | ‚≠ê –°—Ç–∞—Ä—Ç | 10 | ‚Äî | 10 | 75‚≠ê | 78‚ÇΩ | 7.5 | 420% | ‚Äî |
| pop | üíé –ü–æ–ø | 30 | ‚Äî | 30 | 175‚≠ê | 182‚ÇΩ | 5.8 | 304% | ‚Äî |
| pro | üëë –ü—Ä–æ | 100 | ‚Äî | 100 | 500‚≠ê | 520‚ÇΩ | 5.0 | 247% | ‚Äî |
| max | üöÄ –ú–∞–∫—Å | 250 | ‚Äî | 250 | 1125‚≠ê | 1170‚ÇΩ | 4.5 | 212% | ‚Äî |

### –°–∫–∏–¥–æ—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (hidden)

–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ UI. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–º–æ, abandoned cart, admin-–¥–∏—Å–∫–æ–Ω—Ç–æ–≤.

| –°–∫–∏–¥–∫–∞ | –ü–æ–ø—Ä–æ–±—É–π | –°—Ç–∞—Ä—Ç | –ü–æ–ø | –ü—Ä–æ | –ú–∞–∫—Å |
|---|---|---|---|---|---|
| –ë–∞–∑–æ–≤–∞—è | 49‚≠ê | 75‚≠ê | 175‚≠ê | 500‚≠ê | 1125‚≠ê |
| -10% | 44‚≠ê | 68‚≠ê | 158‚≠ê | 450‚≠ê | 1013‚≠ê |
| -15% | 42‚≠ê | 64‚≠ê | 149‚≠ê | 425‚≠ê | 956‚≠ê |
| -25% | 37‚≠ê | 56‚≠ê | 131‚≠ê | 375‚≠ê | 844‚≠ê |

### Trial-–ø–∞–∫–µ—Ç: bonus_credits

–ü–∞–∫–µ—Ç `üéÅ –ü–æ–ø—Ä–æ–±—É–π` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `bonus_credits`:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç –∑–∞ 5 –∫—Ä–µ–¥–∏—Ç–æ–≤, –ø–æ–ª—É—á–∞–µ—Ç 10 (5 + 5 –±–æ–Ω—É—Å).
- –í `successful_payment` –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è `credits + bonus_credits`.
- –°–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ `has_purchased = true`.

---

## –§–ª–æ—É –æ–ø–ª–∞—Ç—ã

```mermaid
sequenceDiagram
    participant U as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant BOT as Bot
    participant TG as Telegram
    participant DB as PostgreSQL

    U->>BOT: –í—ã–±–æ—Ä –ø–∞–∫–µ—Ç–∞ (pack_10_75)
    BOT->>DB: Find active created tx (TTL lock)
    alt Fresh active tx exists
        BOT->>BOT: Reuse existing transaction
    else No fresh active tx
        BOT->>DB: INSERT transaction (state: created)
    end
    BOT->>TG: sendInvoice (Stars)
    TG->>U: –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞—Ç—ë–∂–Ω—É—é —Ñ–æ—Ä–º—É

    U->>TG: –û–ø–ª–∞—Ç–∏—Ç—å
    TG->>BOT: pre_checkout_query
    BOT->>TG: answerPreCheckoutQuery(ok: true)
    Note over BOT: Instant OK ‚Äî –±–µ–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

    TG->>BOT: successful_payment
    BOT->>DB: Idempotency check (charge_id)
    BOT->>DB: UPDATE transaction ‚Üí state: done
    Note over DB: Trigger: add_credits_on_transaction
    BOT->>DB: credits += pack.credits + pack.bonus_credits
    DB-->>BOT: User credits updated

    alt –ü–µ—Ä–≤–∞—è –ø–æ–∫—É–ø–∫–∞
        BOT->>DB: has_purchased = true
    end

    alt –°–µ—Å—Å–∏—è –∂–¥—ë—Ç –∫—Ä–µ–¥–∏—Ç—ã
        BOT->>BOT: –ê–≤—Ç–æ–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    end

    BOT->>U: "–ö—Ä–µ–¥–∏—Ç—ã –∑–∞—á–∏—Å–ª–µ–Ω—ã! ‚úÖ"
```

## Paywall

### –ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

```mermaid
flowchart TD
    START[startGeneration] --> CHECK{credits >= needed?}
    CHECK -->|–î–∞| DEDUCT[–°–ø–∏—Å–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã<br/>‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è]
    CHECK -->|–ù–µ—Ç| PURCHASED{has_purchased?}
    PURCHASED -->|–ù–µ—Ç| FIRST[wait_first_purchase<br/>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:<br/>"–ü–µ—Ä–≤—ã–π —Å—Ç–∏–∫–µ—Ä –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π<br/>–Ω–µ –ø–æ–ª—É—á–∏–ª—Å—è? –ö—É–ø–∏ –ø–∞–∫–µ—Ç!"]
    PURCHASED -->|–î–∞| BUY[wait_buy_credit<br/>"–ö—Ä–µ–¥–∏—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å,<br/>–≤—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç"]
    FIRST --> PACKS[–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–∫–µ—Ç—ã]
    BUY --> PACKS
```

### –ê–≤—Ç–æ–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

–ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –±—ã–ª–∞ –≤ `wait_first_purchase` –∏–ª–∏ `wait_buy_credit`:
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º `session.prompt_final` ‚Äî –µ—Å—Ç—å –ª–∏ –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
2. –ï—Å–ª–∏ –¥–∞ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–ö—Ä–µ–¥–∏—Ç—ã –∑–∞—á–∏—Å–ª–µ–Ω—ã, –≤—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å"

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞, –∏ –¥–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.

## –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

–ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è:
1. `telegram_payment_charge_id` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
2. UPDATE —Å —É—Å–ª–æ–≤–∏–µ–º `state = 'created'` ‚Äî —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
3. Recovery-path: –µ—Å–ª–∏ `created` –Ω–µ –Ω–∞–π–¥–µ–Ω (–≥–æ–Ω–∫–∞ callback-–æ–≤), –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å tx –ø–æ `id`
4. –ï—Å–ª–∏ charge_id —É–∂–µ –µ—Å—Ç—å ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º

## –ê–Ω—Ç–∏–¥—É–±–ª—å –∏–Ω–≤–æ–π—Å–æ–≤

–í `pack_select` –¥–µ–π—Å—Ç–≤—É–µ—Ç –µ–¥–∏–Ω—ã–π lock –Ω–∞ –∞–∫—Ç–∏–≤–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (`state='created'`, TTL 15 –º–∏–Ω—É—Ç):
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ –ø–æ —Ç–æ–º—É –∂–µ –ø–∞–∫–µ—Ç—É –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é transaction/payload.
- –ö–ª–∏–∫ –ø–æ –¥—Ä—É–≥–æ–º—É –ø–∞–∫–µ—Ç—É –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –æ–ø–ª–∞—Ç–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- –ù–æ–≤–∞—è transaction —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–≤–µ–∂–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π.

–≠—Ç–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –≤—Ö–æ–¥–∞ –≤ –æ–ø–ª–∞—Ç—É, –ø–æ—Ç–æ–º—É —á—Ç–æ hidden/admin/abandoned-cart —Ç–∞—Ä–∏—Ñ—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ callback `pack_{credits}_{price}`.

---

## –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞ ‚Äî –æ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ñ–∞–∫—Ç –æ–ø–ª–∞—Ç—ã –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫—É –ø–æ yclid, —á—Ç–æ–±—ã –î–∏—Ä–µ–∫—Ç –º–æ–≥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏–∏ –Ω–∞ –ø–æ–∫—É–ø–∫–∏ (–∞ –Ω–µ –Ω–∞ –∫–ª–∏–∫–∏). –ü–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–ª–µ–π ‚Äî –≤ `docs/13-02-yandex-direct-conversions.md`.

### –ö—Ç–æ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–æ–ª—å |
|-----------|------|
| **–õ–µ–Ω–¥–∏–Ω–≥** (`/landing`) | –°–æ–±–∏—Ä–∞–µ—Ç `utm_*` –∏ `yclid` –∏–∑ URL, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç deep link –≤ –±–æ—Ç–∞. –°–æ–±—ã—Ç–∏—è –≤ –ú–µ—Ç—Ä–∏–∫—É **–Ω–µ** —à–ª—ë—Ç. |
| **–ë–æ—Ç (API)** | –ü–∞—Ä—Å–∏—Ç start payload ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `users.yclid` (first-click). –ü—Ä–∏ `successful_payment` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ API –ú–µ—Ç—Ä–∏–∫–∏. |
| **–ú–µ—Ç—Ä–∏–∫–∞** | –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ (multipart/form-data, CSV —Å UserId=yclid, Target, DateTime Unix, Price, Currency). |

### –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è

- –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `successful_payment`, –ø–æ—Å–ª–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤.
- **–£—Å–ª–æ–≤–∏—è:** —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å `yclid` (–∏–ª–∏ –æ–Ω –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ `start_payload` –ø—Ä–∏ –ø—É—Å—Ç–æ–º `users.yclid`), `transaction.price > 0`, –ø–æ —ç—Ç–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –µ—â—ë –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ (`yandex_conversion_sent_at` –ø—É—Å—Ç–æ).
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ü—Ä–∏ –æ—à–∏–±–∫–µ API ‚Äî –∞–ª–µ—Ä—Ç `metrika_error`, –≤ `transactions` –ø–∏—à–µ—Ç—Å—è `yandex_conversion_error`, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ –¥–µ–ª–∞–µ—Ç—Å—è (–∞–Ω—Ç–∏–¥—É–±–ª—å –ø–æ `yandex_conversion_sent_at`).

### –¶–µ–ª–∏ (Target) –ø–æ –ø–∞–∫–µ—Ç–∞–º

–ë–æ—Ç —à–ª—ë—Ç –≤ –ø–æ–ª–µ Target –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π; –≤ –ú–µ—Ç—Ä–∏–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã —Ü–µ–ª–∏ —Å **—Ç–∞–∫–∏–º–∏ –∂–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏** (—Ç–∏–ø ¬´JavaScript-—Å–æ–±—ã—Ç–∏–µ¬ª –¥–ª—è –æ—Ñ–ª–∞–π–Ω-–∑–∞–≥—Ä—É–∑–æ–∫):

| –ü–∞–∫–µ—Ç | Target |
|-------|--------|
| Trial (5+5) | `purchase_try` |
| –°—Ç–∞—Ä—Ç 10 | `purchase_start` |
| –ü–æ–ø 30 | `purchase_pop` |
| –ü—Ä–æ 100 | `purchase_pro` |
| –ú–∞–∫—Å 250 | `purchase_max` |
| –ü—Ä–æ—á–µ–µ (—Å–∫—Ä—ã—Ç—ã–µ/—Å–∫–∏–¥–æ—á–Ω—ã–µ) | `purchase` |

### –ö–æ–¥ –∏ –∫–æ–Ω—Ñ–∏–≥

- **–ú–æ–¥—É–ª—å:** `src/lib/yandex-metrika.ts` ‚Äî `sendYandexConversion()`, –º–∞–ø–ø–∏–Ω–≥ –ø–∞–∫–µ—Ç–∞ –≤ target —á–µ—Ä–µ–∑ `getMetrikaTargetForPack()`.
- **Env (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):** `YANDEX_METRIKA_COUNTER_ID`, `YANDEX_METRIKA_TOKEN` (OAuth **access token** —Å –ø—Ä–∞–≤–æ–º `metrika:write` –∏–ª–∏ `metrika:offline_data`). –ë–µ–∑ –Ω–∏—Ö –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –≤ –ª–æ–≥ –ø–∏—à–µ—Ç—Å—è `[metrika] Skipped` –∏–ª–∏ `[metrika] Conversion skipped ... reason: no yclid`.
- **–ë–î:** `users.yclid`, `transactions.yandex_conversion_sent_at`, `yandex_conversion_error`, `yandex_conversion_attempts` (–º–∏–≥—Ä–∞—Ü–∏—è `sql/089_yclid_tracking.sql`).

### First-click

`users.yclid` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ (–∏–ª–∏ –µ—Å–ª–∏ –ø–æ–ª–µ –±—ã–ª–æ –ø—É—Å—Ç–æ). –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ —Å –¥—Ä—É–≥–∏–º yclid –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.

---

## Trial Credits (AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç)

AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—Ä–µ–¥–∏—Ç —á–µ—Ä–µ–∑ `grant_trial_credit`:

- **–õ–∏–º–∏—Ç**: 20 trial credits –≤ –¥–µ–Ω—å (–≥–ª–æ–±–∞–ª—å–Ω–æ)
- **–£—Å–ª–æ–≤–∏—è**: `credits = 0`, `has_purchased = false`
- **–§–∞–∫—Ç–æ—Ä—ã —Ä–µ—à–µ–Ω–∏—è**: engagement, intent quality, traffic source
- **Traffic source –±–æ–Ω—É—Å**: yandex, google –∏ –¥—Ä—É–≥–∏–µ –ø–ª–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª–µ–µ –ª—ë–≥–∫–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ

## Abandoned Cart

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `state: created` –±–æ–ª–µ–µ N –º–∏–Ω—É—Ç ‚Äî abandoned cart:
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è reminder –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- Alert –≤ –∫–∞–Ω–∞–ª –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ò–Ω–¥–µ–∫—Å—ã: `idx_transactions_abandoned_cart`, `idx_transactions_abandoned_cart_alert`
