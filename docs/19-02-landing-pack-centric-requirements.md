# Лендинг: отображение Hero и блоков стилей — требования

Единая логика для кластерных страниц; отдельная логика для страниц группы стилей и страниц подстиля. Всё завязано на паки (9 стикеров) и флаги в БД.

---

## 1. Типы страниц

| Тип | Примеры URL | Логика |
|-----|-------------|--------|
| **Кластерные** | `/`, `/style`, `/bot`, … (все, где один шаблон с Hero + блок «Стили») | Одинаковая для всех. |
| **Страница группы стилей** | `/style/[group]` (например `/style/anime`) | Hero = пак первого стиля в группе; блок «Стили» = подстили группы. |
| **Страница подстиля** | `/style/[group]/[substyle]` (например `/style/anime/chibi`) | Hero = пак этого стиля; блока «Стили» нет. |

---

## 2. БД: новые поля и предложение по `cluster`

### 2.1. Где хранить «показывать пак в Hero на кластерных»

**Предложение:** колонка **`cluster`** (boolean, default false) в таблице **`pack_content_sets`**.

- **Уточнение:** пак по контенту (content set) в боте может быть сгенерирован в **любом** стиле (пользователь выбирает стиль из `style_presets_v2`). Это не обязательно photo_realistic. Для Hero на кластерных страницах единый отображаемый стиль задаётся пресетом с `landing_cluster = true` (см. п. 2.2); при «сделать примером» для content set обычно берут пак, сгенерированный в этом же стиле.
- `cluster = true` → этот пак (content set) показывается в Hero на всех кластерных страницах.
- Пилюли = список паков с `cluster = true`, порядок по `sort_order`.
- Клик по пилюле = смена карусели на выбранный пак (те же 9 стикеров этого content set).

### 2.2. Стиль Hero на кластерных

В **`style_presets_v2`** добавляется колонка **`landing_cluster`** (boolean, default false).

- `landing_cluster = true` → этот пресет используется как стиль для Hero на всех кластерных страницах: все паки в Hero рисуются в этом стиле.
- В любой момент **только один** пресет может иметь `landing_cluster = true` (логика приложения или уникальный частичный индекс). Сменить стиль Hero на кластерных = переключить флаг на другой пресет.
- Переключение по пилюлям меняет только пак (content set), стиль остаётся тем, у кого `landing_cluster = true`.

### 2.3. Какие стили показывать в блоке «Стили» на кластерных

В **`style_presets_v2`** добавляется колонка **`landing`** (boolean, default false).

- `landing = true` → этот **конкретный стиль (пресет)** выводится карточкой в блоке «Стили» на кластерных страницах и для него есть дочерняя страница `/style/[group]/[substyle]`.
- В блоке «Стили» на кластерных: **все пресеты с `landing = true`** в одном списке, порядок по **`sort_order`** из `style_presets_v2` (без разбивки по группам в UI — просто плоский список карточек).
- Каждая карточка = один пресет: превью (первый стикер пака этого стиля, см. п. 4) + ссылка на `/style/[group]/[substyle]` этого пресета.

Итого: в блоке «Стили» — по одному пресету (конкретный стиль), а не «группа». Группа нужна только для маршрута и SEO.

---

## 3. Кластерные страницы (главная и все с тем же шаблоном)

Логика **единая** для всех: главная `/`, страница `/style`, `/bot` и любые другие кластерные.

### Hero

- **Пилюли:** паки из `pack_content_sets` с `cluster = true`, порядок по `sort_order`. Название пилюли = `name_ru`.
- **Карусель:** 9 стикеров выбранного пака. Стиль = пресет с **`landing_cluster = true`** (в момент только один такой). Файлы в Storage: пак задаётся **content_set_id** (см. п. 6).
- Сменить стиль в Hero на кластерных = поменять в БД, у какого пресета `landing_cluster = true`; в UI переключается только пак (пилюля).

### Блок «Стили»

- **Карточки:** все пресеты из `style_presets_v2` с `landing = true`, порядок по `sort_order` (общий по всем группам).
- На карточке: превью стиля (первый стикер пака этого пресета) + название/ссылка на страницу подстиля `/style/[group]/[substyle]`.

---

## 4. Страница группы стилей `/style/[group]`

Пример: `/style/anime`.

### Hero

- Показывается **пак того стиля, который в группе идёт первым** по `sort_order` в `style_presets_v2`.
- То есть: первый пресет в этой группе → у него свой пак (9 стикеров) → он и показывается в Hero. Пак привязан к **style_preset_id** (см. п. 6).

### Блок «Стили»

- Список **всех подстилей (пресетов) этой группы** с `landing = true` (или всех пресетов группы — уточнить: только landing или все).
- На каждой карточке — **первый стикер** из пака этого подстиля (превью подстиля).
- Ссылка → `/style/[group]/[substyle]`.

---

## 5. Страница подстиля `/style/[group]/[substyle]`

Пример: `/style/anime/chibi`.

### Hero

- Показывается **пак, привязанный к этому style_preset_id** (один пак на пресет, 9 стикеров).
- Источник: Storage по `style_preset_id` (см. п. 6).

### Блок «Стили»

- **Не выводится.**

---

## 6. Storage (bucket stickers-examples) и типы паков

Два вида «пака» по смыслу использования:

| Тип | Ключ | Где используется |
|-----|-----|-------------------|
| Пак по content set | `pack/content/{content_set_id}/1.webp` … `9.webp` | Hero на кластерных: пилюли = content sets с cluster=true, стиль = пресет с landing_cluster=true. |
| Пак по стилю | `pack/style/{style_preset_id}/1.webp` … `9.webp` | Hero на странице группы (пак первого стиля в группе) и Hero на странице подстиля (пак этого пресета). |

- **Кластерные:** карусель = `pack/content/{content_set_id}/1..9.webp`, где content_set_id выбранной пилюли; стиль задаётся пресетом с `landing_cluster = true` (один в момент).
- **Страница группы:** Hero = `pack/style/{first_preset_id}/1..9.webp`.
- **Страница подстиля:** Hero = `pack/style/{style_preset_id}/1..9.webp`.
- **Превью в блоке «Стили»:** для пресета с `landing = true` — например `pack/style/{style_preset_id}/1.webp` (первый стикер пака этого стиля).

Итоговая структура:

```
pack/
  content/
    {content_set_id}/    # для Hero на кластерных (пилюли)
      1.webp … 9.webp
  style/
    {style_preset_id}/   # для Hero на /style/[group] и /style/[group]/[substyle]
      1.webp … 9.webp
```

---

## 7. Сводка: где что показывать

| Место | Hero | Блок «Стили» |
|-------|------|----------------|
| Кластерные (/, /style, /bot, …) | Паки с `cluster = true`, стиль = пресет с `landing_cluster = true` (один в момент); пилюли = эти паки. | Все пресеты с `landing = true` по sort_order; карточка = пресет, превью = 1.webp пака этого пресета. |
| `/style/[group]` | Пак первого пресета группы: `pack/style/{first_preset_id}/1..9.webp`. | Все подстили группы; превью = первый стикер пака подстиля. |
| `/style/[group]/[substyle]` | Пак этого пресета: `pack/style/{style_preset_id}/1..9.webp`. | Не выводится. |

---

## 8. Изменения в БД (итог)

1. **pack_content_sets:** колонка **`cluster`** (boolean, default false). Если true — пак участвует в Hero на кластерных (и в пилюлях).
2. **style_presets_v2:**  
   - **`landing_cluster`** (boolean, default false). Если true — этот пресет используется как стиль для Hero на кластерных. В любой момент только один пресет с `landing_cluster = true`.  
   - **`landing`** (boolean, default false). Если true — пресет показывается карточкой в блоке «Стили» на кластерных и имеет страницу подстиля.

---

## 9. Связанные документы

- БД: `docs/architecture/04-database.md` (pack_content_sets, style_presets_v2, style_groups)
- Storage: `docs/architecture/08-deployment.md` (бакет stickers-examples)
- Лендинг: `docs/landing-db-content-requirements.md`, `docs/seo-landing-pages-spec.md`
