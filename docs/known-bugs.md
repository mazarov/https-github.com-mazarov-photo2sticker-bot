# Known Bugs

## 1. Белый фон у стикера в уведомлениях
Telegram API `sendMediaGroup` с `type: "photo"` рендерит прозрачность как белый фон.
Компонент: `alerts.ts`, `worker.ts`

## 2. Нет retry логики для Telegram API
При ошибке отправки сообщения (таймаут, 5xx) нет повторных попыток — сообщение теряется.
Компонент: `telegram.ts`, `alerts.ts`

## 3. In-memory Maps теряются при рестарте
`pendingFeedback` и `pendingIssues` в support-bot хранятся в памяти, теряются при рестарте.
Компонент: `support-bot.ts`

## 4. Нет rate limiting
Нет защиты от спама. Кредиты — единственное ограничение.
Компонент: `index.ts`, `worker.ts`

## 5. ~~Дублирование сообщений баланса~~ ✅ FIXED
~~При показе баланса сначала шлём "Твой баланс" с кнопкой "Top up", потом тот же текст с кнопками тарифов.~~
Решение: /balance сразу показывает баланс + тарифы без промежуточной кнопки.
Компонент: `index.ts`

## 6. Нет EN локализации для "закончились бесплатные кредиты"
Уведомление о том что закончились бесплатные кредиты показывается только на русском.
Компонент: `index.ts`, `texts.ts`

## 7. Дублирование уведомления "закончились кредиты"
Проверка триггера идёт только на `status: "pending"`. Если триггер уже `fired`, создаётся новый — сообщение приходит повторно.
Компонент: `worker.ts`

## 8. Обрезка нижней части стикера при генерации эмоции
При генерации эмоции нижняя часть стикера может быть слегка обрезана/смазана.
Возможные причины:
- `trim({ threshold: 10 })` слишком агрессивно обрезает полупрозрачные края
- Двойной resize (для rembg и финальный)
- Gemini может генерировать изображение с изменёнными пропорциями
Пример: sticker_id `5ef92617-0554-4d55-917d-d47ffe1f5e1b`
Компонент: `worker.ts`
